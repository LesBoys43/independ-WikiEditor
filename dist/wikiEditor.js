(() => {
  var __defProp = Object.defineProperty;
  var __getOwnPropNames = Object.getOwnPropertyNames;
  var __name = (target, value) => __defProp(target, "name", { value, configurable: true });
  var __commonJS = (cb, mod) => function __require() {
    return mod || (0, cb[__getOwnPropNames(cb)[0]])((mod = { exports: {} }).exports, mod), mod.exports;
  };

  // ext.wikiEditor.i18n.js
  var require_ext_wikiEditor_i18n = __commonJS({
    "ext.wikiEditor.i18n.js"(exports, module) {
      var __i18n_text = {
        "@metadata": {
          "authors": [
            "Anakmalaysia",
            "Anarkiisto",
            "Bencmq",
            "Diskdance",
            "Fantasticfears",
            "Gaoxuewei",
            "GuoPC",
            "Hydra",
            "Lakejason0",
            "Lantx",
            "Liangent",
            "LittlePaw365",
            "Liuxinyu970226",
            "Onecountry",
            "PhiLiP",
            "Shirayuki",
            "Shizhao",
            "Simon Shek",
            "Stang",
            "Tranve",
            "VulpesVulpes825",
            "Winston Sung",
            "Xiaomingyan",
            "Zhang8569",
            "\u5217\u7EF4\u52B3\u5FB7",
            "\u6C88\u6F84\u5FC3",
            "\u94C1\u6876"
          ]
        },
        "wikieditor": "\u9AD8\u7EA7wikitext\u7F16\u8F91\u754C\u9762",
        "wikieditor-desc": "\u63D0\u4F9B\u9AD8\u7EA7\u3001\u53EF\u6269\u5C55\u7684wikitext\u7F16\u8F91\u754C\u9762",
        "wikieditor-toolbar": "\u7F16\u8F91\u5DE5\u5177\u680F",
        "wikieditor-toolbar-desc": "\u6709\u589E\u5F3A\u7684\u4F7F\u7528\u6027\u80FD\u7684\u9875\u9762\u7F16\u8F91\u5DE5\u5177\u680F",
        "wikieditor-toolbar-preference": "\u542F\u7528\u7F16\u8F91\u5DE5\u5177\u680F",
        "wikieditor-toolbar-preference-help": "\u6B64\u529F\u80FD\u6709\u65F6\u79F0\u4F5C\u201C2010\u5E74\u7248wikitext\u7F16\u8F91\u5668\u201D\u3002",
        "wikieditor-toolbar-tool-bold": "\u7C97\u4F53",
        "wikieditor-toolbar-tool-bold-example": "\u7C97\u4F53\u6587\u672C",
        "wikieditor-toolbar-tool-italic": "\u659C\u4F53",
        "wikieditor-toolbar-tool-italic-example": "\u659C\u4F53\u6587\u672C",
        "wikieditor-toolbar-tool-link": "\u94FE\u63A5",
        "wikieditor-toolbar-tool-link-title": "\u63D2\u5165\u94FE\u63A5",
        "wikieditor-toolbar-tool-link-int": "\u94FE\u5F80wiki\u9875\u9762",
        "wikieditor-toolbar-tool-link-int-target": "\u76EE\u6807\u9875\u9762\u6216\u7F51\u5740\uFF1A",
        "wikieditor-toolbar-tool-link-int-target-tooltip": "\u9875\u9762\u7684\u6807\u9898\u6216URL",
        "wikieditor-toolbar-tool-link-int-text": "\u663E\u793A\u6587\u672C\uFF1A",
        "wikieditor-toolbar-tool-link-int-text-tooltip": "\u8981\u663E\u793A\u7684\u6587\u672C",
        "wikieditor-toolbar-tool-link-ext": "\u94FE\u5F80\u5916\u90E8\u7F51\u9875",
        "wikieditor-toolbar-tool-link-ext-target": "\u94FE\u63A5\u7F51\u5740\uFF1A",
        "wikieditor-toolbar-tool-link-ext-text": "\u94FE\u63A5\u6587\u672C\uFF1A",
        "wikieditor-toolbar-tool-link-insert": "\u63D2\u5165\u94FE\u63A5",
        "wikieditor-toolbar-tool-link-cancel": "\u53D6\u6D88",
        "wikieditor-toolbar-tool-link-int-target-status-exists": "{{SITENAME}}\u4E0A\u5B58\u5728\u8BE5\u9875\u9762",
        "wikieditor-toolbar-tool-link-int-target-status-notexists": "\u8BE5\u9875\u9762\u5728 {{SITENAME}} \u4E0A\u4E0D\u5B58\u5728",
        "wikieditor-toolbar-tool-link-int-target-status-invalid": "\u60A8\u6307\u5B9A\u7684\u6807\u9898\u65E0\u6548",
        "wikieditor-toolbar-tool-link-int-target-status-external": "\u5916\u90E8\u94FE\u63A5",
        "wikieditor-toolbar-tool-link-int-target-status-disambig": "\u6B64\u9875\u9762\u4E0D\u662F\u4E00\u4E2A\u5185\u5BB9\u9875\u9762\uFF0C\u800C\u662F\u4E00\u4E2A\u5217\u51FA\u4E86\u5177\u6709\u76F8\u4F3C\u540D\u79F0\u4E3B\u9898\u7684\u5217\u8868",
        "wikieditor-toolbar-tool-link-lookslikeinternal": "\u60A8\u8F93\u5165\u7684\u7F51\u5740\u4F3C\u4E4E\u6307\u5411\u53E6\u4E00\u4E2Awiki\u9875\u9762\u3002\n\u662F\u5426\u5E0C\u671B\u5C06\u5176\u6539\u4E3A\u5185\u90E8\u94FE\u63A5\uFF1F",
        "wikieditor-toolbar-tool-link-lookslikeinternal-int": "\u5185\u90E8\u94FE\u63A5",
        "wikieditor-toolbar-tool-link-lookslikeinternal-ext": "\u5916\u90E8\u94FE\u63A5",
        "wikieditor-toolbar-tool-file": "\u56FE\u7247\u548C\u5A92\u4F53",
        "wikieditor-toolbar-tool-file-title": "\u63D2\u5165\u6587\u4EF6",
        "wikieditor-toolbar-file-target": "\u6587\u4EF6\u540D\uFF1A",
        "wikieditor-toolbar-file-caption": "\u6807\u9898\uFF1A",
        "wikieditor-toolbar-file-alt": "\u53EF\u66FF\u4EE3\u6587\u672C",
        "wikieditor-toolbar-file-alt-help": "\u60A8\u53EF\u4EE5\u7528\u6B64\u53EF\u9009\u533A\u57DF\u6765\u4E3A\u90A3\u4E9B\u4E0D\u80FD\u770B\u89C1\u9879\u76EE\u7684\u4EBA\u4EEC\u5199\u4E00\u6BB5\u6587\u5B57\u63CF\u8FF0\u3002\u8FD9\u6BB5\u63CF\u8FF0\u5E94\u8BE5\u8BA9\u4ED6\u4EEC\u8DB3\u591F\u7406\u89E3\u5A92\u4F53\u9879\u76EE\u63D0\u4F9B\u7684\u76EE\u7684\u548C\u4FE1\u606F\u3002\u8FD9\u5BF9\u4E8E\u76F2\u4EBA\u7528\u6237\u548C\u5176\u4ED6\u4F7F\u7528\u5C4F\u5E55\u9605\u8BFB\u5668\u8F6F\u4EF6\u6216\u7EAF\u6587\u672C\u6D4F\u89C8\u5668\u7684\u4EBA\u4EEC\u6765\u8BF4\u662F\u81F3\u5173\u91CD\u8981\u7684\u3002",
        "wikieditor-toolbar-file-alt-help-label": "\uFF08\u663E\u793A\u5E2E\u52A9\uFF09",
        "wikieditor-toolbar-file-size": "\u5C3A\u5BF8\uFF1A",
        "wikieditor-toolbar-file-float": "\u5BF9\u9F50\uFF1A",
        "wikieditor-toolbar-file-default": "\uFF08\u9ED8\u8BA4\uFF09",
        "wikieditor-toolbar-file-format": "\u683C\u5F0F\uFF1A",
        "wikieditor-toolbar-file-format-none": "\u65E0",
        "wikieditor-toolbar-tool-file-insert": "\u63D2\u5165",
        "wikieditor-toolbar-tool-file-cancel": "\u53D6\u6D88",
        "wikieditor-toolbar-tool-file-upload": "\u4E0A\u4F20",
        "wikieditor-toolbar-tool-signature": "\u7B7E\u540D\u53CA\u65F6\u95F4\u6233",
        "wikieditor-toolbar-section-advanced": "\u9AD8\u7EA7",
        "wikieditor-toolbar-tool-heading": "\u6807\u9898",
        "wikieditor-toolbar-tool-heading-1": "1\u7EA7",
        "wikieditor-toolbar-tool-heading-2": "2\u7EA7",
        "wikieditor-toolbar-tool-heading-3": "3\u7EA7",
        "wikieditor-toolbar-tool-heading-4": "4\u7EA7",
        "wikieditor-toolbar-tool-heading-5": "5\u7EA7",
        "wikieditor-toolbar-tool-heading-example": "\u6807\u9898\u6587\u672C",
        "wikieditor-toolbar-group-format": "\u683C\u5F0F",
        "wikieditor-toolbar-tool-ulist": "\u65E0\u5E8F\u5217\u8868",
        "wikieditor-toolbar-tool-ulist-example": "\u65E0\u5E8F\u5217\u8868\u9879",
        "wikieditor-toolbar-tool-olist": "\u6709\u5E8F\u5217\u8868",
        "wikieditor-toolbar-tool-olist-example": "\u6709\u5E8F\u5217\u8868\u9879",
        "wikieditor-toolbar-tool-code": "\u4EE3\u7801",
        "wikieditor-toolbar-tool-code-example": "\u4EE3\u7801",
        "wikieditor-toolbar-tool-nowiki": "\u975Ewiki\u683C\u5F0F",
        "wikieditor-toolbar-tool-nowiki-example": "\u8BF7\u5728\u8FD9\u91CC\u63D2\u5165\u975E\u683C\u5F0F\u5316\u6587\u672C",
        "wikieditor-toolbar-tool-redirect": "\u91CD\u5B9A\u5411",
        "wikieditor-toolbar-tool-redirect-example": "\u76EE\u6807\u9875\u9762\u540D\u79F0",
        "wikieditor-toolbar-tool-big": "\u5927\u53F7",
        "wikieditor-toolbar-tool-big-example": "\u5927\u53F7\u6587\u672C",
        "wikieditor-toolbar-tool-small": "\u5C0F\u53F7",
        "wikieditor-toolbar-tool-small-example": "\u5C0F\u53F7\u6587\u672C",
        "wikieditor-toolbar-tool-superscript": "\u4E0A\u6807",
        "wikieditor-toolbar-tool-superscript-example": "\u4E0A\u6807\u6587\u672C",
        "wikieditor-toolbar-tool-subscript": "\u4E0B\u6807",
        "wikieditor-toolbar-tool-subscript-example": "\u4E0B\u6807\u6587\u672C",
        "wikieditor-toolbar-group-insert": "\u63D2\u5165",
        "wikieditor-toolbar-tool-gallery": "\u56FE\u5E93",
        "wikieditor-toolbar-tool-gallery-example": "\u793A\u4F8B.jpg|\u8BF4\u660E1\n\u793A\u4F8B.jpg|\u8BF4\u660E2",
        "wikieditor-toolbar-tool-newline": "\u6362\u884C",
        "wikieditor-toolbar-tool-table": "\u8868\u683C",
        "wikieditor-toolbar-tool-table-example-cell-text": "\u5355\u5143\u683C\u6587\u672C",
        "wikieditor-toolbar-tool-table-example-header": "\u6807\u9898\u6587\u672C",
        "wikieditor-toolbar-tool-table-example-caption": "\u6807\u9898\u6587\u672C",
        "wikieditor-toolbar-tool-table-title": "\u63D2\u5165\u8868\u683C",
        "wikieditor-toolbar-tool-table-dimensions-rows": "\u884C\u6570",
        "wikieditor-toolbar-tool-table-dimensions-columns": "\u5217\u6570",
        "wikieditor-toolbar-tool-table-dimensions-header": "\u6DFB\u52A0\u6807\u9898\u884C",
        "wikieditor-toolbar-tool-table-wikitable": "\u663E\u793A\u8FB9\u6846",
        "wikieditor-toolbar-tool-table-sortable": "\u4F7F\u8868\u683C\u5185\u5BB9\u53EF\u6392\u5E8F",
        "wikieditor-toolbar-tool-table-example": "\u793A\u4F8B",
        "wikieditor-toolbar-tool-table-preview": "\u9884\u89C8",
        "wikieditor-toolbar-tool-table-insert": "\u63D2\u5165",
        "wikieditor-toolbar-tool-table-cancel": "\u53D6\u6D88",
        "wikieditor-toolbar-tool-table-toomany": "\u5728\u8FD9\u4E2A\u5BF9\u8BDD\u6846\u4E2D\u65E0\u6CD5\u63D2\u5165\u8D85\u8FC7$1\u4E2A{{PLURAL:$1|\u5355\u5143\u683C}}\u7684\u8868\u683C\u3002",
        "wikieditor-toolbar-tool-table-invalidnumber": "\u60A8\u8F93\u5165\u7684\u884C\u6570\u6216\u5217\u6570\u65E0\u6548\u3002",
        "wikieditor-toolbar-tool-table-zero": "\u60A8\u4E0D\u80FD\u63D2\u5165\u4E00\u4E2A\u96F6\u884C\u6216\u96F6\u5217\u7684\u8868\u683C\u3002",
        "wikieditor-toolbar-tool-replace": "\u67E5\u627E\u548C\u66FF\u6362",
        "wikieditor-toolbar-tool-replace-title": "\u67E5\u627E\u548C\u66FF\u6362",
        "wikieditor-toolbar-tool-replace-search": "\u67E5\u627E\uFF1A",
        "wikieditor-toolbar-tool-replace-replace": "\u66FF\u6362\u4E3A\uFF1A",
        "wikieditor-toolbar-tool-replace-case": "\u533A\u5206\u5927\u5C0F\u5199",
        "wikieditor-toolbar-tool-replace-regex": "\u4F7F\u7528\u6B63\u5219\u8868\u8FBE\u5F0F",
        "wikieditor-toolbar-tool-replace-button-findnext": "\u67E5\u627E\u4E0B\u4E00\u4E2A",
        "wikieditor-toolbar-tool-replace-button-replace": "\u66FF\u6362",
        "wikieditor-toolbar-tool-replace-button-replaceall": "\u66FF\u6362\u6240\u6709",
        "wikieditor-toolbar-tool-replace-close": "\u5173\u95ED",
        "wikieditor-toolbar-tool-replace-nomatch": "\u6CA1\u6709\u627E\u5230\u4EFB\u4F55\u5339\u914D\u9879\u3002",
        "wikieditor-toolbar-tool-replace-success": "\u5B8C\u6210\u4E86$1\u6B21{{PLURAL:$1|\u66FF\u6362}}\u3002",
        "wikieditor-toolbar-tool-replace-emptysearch": "\u60A8\u6CA1\u6709\u8F93\u5165\u67E5\u627E\u5185\u5BB9\u3002",
        "wikieditor-toolbar-tool-replace-invalidregex": "\u60A8\u8F93\u5165\u7684\u6B63\u5219\u8868\u8FBE\u5F0F\u65E0\u6548\uFF1A$1",
        "wikieditor-toolbar-tool-replace-word": "\u5168\u5B57\u5339\u914D",
        "wikieditor-toolbar-section-characters": "\u7279\u6B8A\u5B57\u7B26",
        "wikieditor-toolbar-section-help": "\u5E2E\u52A9",
        "wikieditor-toolbar-help-heading-description": "\u8BF4\u660E",
        "wikieditor-toolbar-help-heading-syntax": "\u8F93\u5165\u5185\u5BB9",
        "wikieditor-toolbar-help-heading-result": "\u8F93\u51FA\u7ED3\u679C",
        "wikieditor-toolbar-help-page-format": "\u683C\u5F0F",
        "wikieditor-toolbar-help-page-link": "\u94FE\u63A5",
        "wikieditor-toolbar-help-page-heading": "\u6807\u9898",
        "wikieditor-toolbar-help-page-list": "\u5217\u8868",
        "wikieditor-toolbar-help-page-file": "\u6587\u4EF6",
        "wikieditor-toolbar-help-page-discussion": "\u8BA8\u8BBA",
        "wikieditor-toolbar-help-content-italic-description": "\u659C\u4F53",
        "wikieditor-toolbar-help-content-italic-example": "\u659C\u4F53\u6587\u5B57",
        "wikieditor-toolbar-help-content-bold-description": "\u7C97\u4F53",
        "wikieditor-toolbar-help-content-bold-example": "\u7C97\u4F53\u6587\u5B57",
        "wikieditor-toolbar-help-content-bolditalic-description": "\u7C97\u659C\u4F53",
        "wikieditor-toolbar-help-content-bolditalic-example": "\u7C97\u659C\u4F53\u6587\u5B57",
        "wikieditor-toolbar-help-content-ilink-description": "\u5185\u90E8\u94FE\u63A5",
        "wikieditor-toolbar-help-content-ilink-example": "[[\u9875\u9762\u6807\u9898]]\n[[\u9875\u9762\u6807\u9898|\u94FE\u63A5\u6807\u7B7E]]",
        "wikieditor-toolbar-help-content-xlink-description": "\u5916\u90E8\u94FE\u63A5",
        "wikieditor-toolbar-help-content-xlink-example-label": "\u94FE\u63A5\u6587\u672C",
        "wikieditor-toolbar-help-content-heading2-description": "2\u7EA7\u6807\u9898",
        "wikieditor-toolbar-help-content-heading2-example": "\u6807\u9898\u6587\u672C",
        "wikieditor-toolbar-help-content-heading3-description": "3\u7EA7\u6807\u9898",
        "wikieditor-toolbar-help-content-heading3-example": "\u6807\u9898\u6587\u672C",
        "wikieditor-toolbar-help-content-heading4-description": "4\u7EA7\u6807\u9898",
        "wikieditor-toolbar-help-content-heading4-example": "\u6807\u9898\u6587\u672C",
        "wikieditor-toolbar-help-content-heading5-description": "5\u7EA7\u6807\u9898",
        "wikieditor-toolbar-help-content-heading5-example": "\u6807\u9898\u6587\u672C",
        "wikieditor-toolbar-help-content-ulist-description": "\u65E0\u5E8F\u5217\u8868",
        "wikieditor-toolbar-help-content-ulist-example": "\u5217\u8868\u9879\u76EE",
        "wikieditor-toolbar-help-content-olist-description": "\u6709\u5E8F\u5217\u8868",
        "wikieditor-toolbar-help-content-olist-example": "\u5217\u8868\u9879\u76EE",
        "wikieditor-toolbar-help-content-file-description": "\u5D4C\u5165\u6587\u4EF6",
        "wikieditor-toolbar-help-content-file-syntax": "[[$1:Example.png|$2|$3]]",
        "wikieditor-toolbar-help-content-file-caption": "\u6807\u9898\u6587\u672C",
        "wikieditor-toolbar-help-content-signaturetimestamp-description": "\u5E26\u65F6\u95F4\u6233\u7684\u7B7E\u540D",
        "wikieditor-toolbar-help-content-signaturetimestamp-example": "--[[$1:$3|$3]]\uFF08[[$2:$3|\u7559\u8A00]]\uFF09 2023\u5E746\u670829\u65E5 (\u56DB) 15:54 (UTC)",
        "wikieditor-toolbar-help-content-signature-description": "\u7B7E\u540D",
        "wikieditor-toolbar-help-content-signature-example": "[[$1:$3|$3]] ([[$2:$3|\u7559\u8A00]])",
        "wikieditor-toolbar-help-content-signature-username": "\u7528\u6237\u540D",
        "wikieditor-toolbar-help-content-indent-description": "\u7F29\u8FDB",
        "wikieditor-toolbar-help-content-indent1": "\u666E\u901A\u6587\u672C",
        "wikieditor-toolbar-help-content-indent2": "\u7F29\u8FDB\u6587\u672C",
        "wikieditor-toolbar-help-content-indent3": "\u7F29\u8FDB\u6587\u672C",
        "tag-wikieditor-description": "\u901A\u8FC7[[mw:Special:MyLanguage/Extension:WikiEditor|WikiEditor]]\uFF082010\u5E74\u7248wikitext\u7F16\u8F91\u5668\uFF09\u505A\u51FA\u7684\u7F16\u8F91",
        "wikieditor-realtimepreview-preview": "\u9884\u89C8",
        "wikieditor-realtimepreview-error": "\u672A\u80FD\u52A0\u8F7D\u9884\u89C8",
        "wikieditor-realtimepreview-reload": "\u91CD\u65B0\u52A0\u8F7D",
        "wikieditor-realtimepreview-reload-title": "\u91CD\u65B0\u52A0\u8F7D\u5B9E\u65F6\u9884\u89C8\u7A97\u683C",
        "wikieditor-realtimepreview-manual": "\u8BF7\u7ACB\u5373\u91CD\u65B0\u52A0\u8F7D\u4EE5\u624B\u52A8\u9884\u89C8\u60A8\u7684\u7F16\u8F91\u3002"
      };
      module.exports = {
        i18n: /* @__PURE__ */ __name(function(msg) {
          let ctx = { __content: __i18n_text[msg], params: /* @__PURE__ */ __name(function() {
            let argv = Array.from(arguments);
            if (argv.length == 1 && typeof argv[0] == "object") {
              Object.keys(argv[0]).forEach((arg) => {
                ctx.__content = ctx.__content.replaceAll(`$${arg}`, argv[0][arg]);
              });
            } else {
              argv.forEach((val, idx) => {
                ctx.__content = ctx.__content.replaceAll(`$${idx + 1}`, val);
              });
            }
            return ctx;
          }, "params"), plain: /* @__PURE__ */ __name(function() {
            return ctx.__content;
          }, "plain"), escaped: /* @__PURE__ */ __name(function() {
            return escape(ctx.plain());
          }, "escaped") };
          ctx.text = ctx.plain;
          ctx.toString = ctx.plain;
          ctx.toLocaleString = ctx.plain;
          if (Array.from(arguments).length > 1) {
            ctx.params.apply(ctx, Array.from(arguments).slice(1, Infinity));
          }
          return ctx;
        }, "i18n")
      };
    }
  });

  // jquery.wikiEditor.toolbar.js
  var require_jquery_wikiEditor_toolbar = __commonJS({
    "jquery.wikiEditor.toolbar.js"(exports, module) {
      var __wikieditor_i18n2 = require_ext_wikiEditor_i18n().i18n;
      var RECENTKEY = "visualeditor-symbolList-recentlyUsed-specialCharacters";
      var toolbarModule = {
        /**
         * API accessible functions
         */
        api: {
          addToToolbar: /* @__PURE__ */ __name(function(context, data) {
            for (const type in data) {
              switch (type) {
                case "sections": {
                  const $sections = context.modules.toolbar.$toolbar.find("div.sections");
                  const $tabs = context.modules.toolbar.$toolbar.find("div.tabs");
                  for (const section in data[type]) {
                    if (section === "main" || section === "secondary") {
                      context.modules.toolbar.$toolbar.prepend(
                        toolbarModule.fn.buildSection(
                          context,
                          section,
                          data[type][section]
                        )
                      );
                      continue;
                    }
                    $sections.append(
                      toolbarModule.fn.buildSection(context, section, data[type][section])
                    );
                    $tabs.append(
                      toolbarModule.fn.buildTab(context, section, data[type][section])
                    );
                  }
                  break;
                }
                case "groups": {
                  if (!("section" in data)) {
                    continue;
                  }
                  const $section = context.modules.toolbar.$toolbar.find('div[rel="' + data.section + '"].section');
                  for (const group in data[type]) {
                    $section.append(
                      toolbarModule.fn.buildGroup(context, group, data[type][group])
                    );
                  }
                  break;
                }
                case "tools": {
                  if (!("section" in data && "group" in data)) {
                    continue;
                  }
                  const $group = context.modules.toolbar.$toolbar.find(
                    'div[rel="' + data.section + '"].section div[rel="' + data.group + '"].group'
                  );
                  for (const tool in data[type]) {
                    $group.append(toolbarModule.fn.buildTool(context, tool, data[type][tool]));
                  }
                  if ($group.children().length) {
                    $group.removeClass("empty");
                  }
                  break;
                }
                case "pages": {
                  if (!("section" in data)) {
                    continue;
                  }
                  const $pages = context.modules.toolbar.$toolbar.find(
                    'div[rel="' + data.section + '"].section .pages'
                  );
                  const $index = context.modules.toolbar.$toolbar.find(
                    'div[rel="' + data.section + '"].section .index'
                  );
                  for (const page in data[type]) {
                    $pages.append(toolbarModule.fn.buildPage(context, page, data[type][page]));
                    $index.append(
                      toolbarModule.fn.buildBookmark(context, page, data[type][page])
                    );
                  }
                  toolbarModule.fn.updateBookletSelection(context, data.section, $pages, $index);
                  break;
                }
                case "rows": {
                  if (!("section" in data && "page" in data)) {
                    continue;
                  }
                  const $table = context.modules.toolbar.$toolbar.find(
                    'div[rel="' + data.section + '"].section div[rel="' + data.page + '"].page table'
                  );
                  for (let i = 0; i < data.rows.length; i++) {
                    $table.append(toolbarModule.fn.buildRow(context, data.rows[i]));
                  }
                  break;
                }
                case "characters": {
                  if (!("section" in data && "page" in data)) {
                    continue;
                  }
                  const $characters = context.modules.toolbar.$toolbar.find(
                    'div[rel="' + data.section + '"].section div[rel="' + data.page + '"].page div'
                  );
                  const actions = $characters.data("actions");
                  for (let i = 0; i < data.characters.length; i++) {
                    $characters.append(
                      toolbarModule.fn.buildCharacter(data.characters[i], actions).on("mousedown", (e) => {
                        e.preventDefault();
                        return false;
                      }).on("click", (e) => {
                        const $character = $(e.target);
                        toolbarModule.fn.doAction(
                          $character.parent().data("context"),
                          $character.parent().data("actions")[$character.attr("rel")]
                        );
                        e.preventDefault();
                        return false;
                      })
                    );
                  }
                  break;
                }
                default:
                  break;
              }
            }
          }, "addToToolbar"),
          removeFromToolbar: /* @__PURE__ */ __name(function(context, data) {
            if (typeof data.section === "string") {
              const tab = 'div.tabs span[rel="' + data.section + '"].tab';
              let target = 'div[rel="' + data.section + '"].section';
              let group = null;
              if (typeof data.group === "string") {
                target += ' div[rel="' + data.group + '"].group';
                if (typeof data.tool === "string") {
                  group = target;
                  target = target + ' [rel="' + data.tool + '"].tool';
                }
              } else if (typeof data.page === "string") {
                const index = target + ' div.index div[rel="' + data.page + '"]';
                target += ' div.pages div[rel="' + data.page + '"].page';
                if (typeof data.character === "string") {
                  target += ' span[rel="' + data.character + '"]';
                } else if (typeof data.row === "number") {
                  target += " table tr:not(:has(th)):eq(" + data.row + ")";
                } else {
                  context.modules.toolbar.$toolbar.find(index).remove();
                  toolbarModule.fn.updateBookletSelection(
                    context,
                    data.section,
                    context.modules.toolbar.$toolbar.find(target),
                    context.modules.toolbar.$toolbar.find(index)
                  );
                }
              } else {
                context.modules.toolbar.$toolbar.find(tab).remove();
              }
              context.modules.toolbar.$toolbar.find(target).remove();
              if (group) {
                const $group = context.modules.toolbar.$toolbar.find(group);
                if ($group.children().length === 0) {
                  $group.addClass("empty");
                }
              }
            }
          }, "removeFromToolbar")
        },
        /**
         * Internally used functions
         */
        fn: {
          /**
           * Creates a toolbar module within a wikiEditor
           *
           * @param {Object} context Context object of editor to create module in
           * @param {Object} config Configuration object to create module from
           */
          create: /* @__PURE__ */ __name(function(context, config) {
            if ("$toolbar" in context.modules.toolbar) {
              return;
            }
            context.modules.toolbar.$toolbar = $("<div>").addClass("wikiEditor-ui-toolbar").attr("id", "wikiEditor-ui-toolbar");
            toolbarModule.fn.build(context, config);
            context.$ui.find(".wikiEditor-ui-top").append(context.modules.toolbar.$toolbar);
          }, "create"),
          /**
           * Performs an operation based on parameters
           *
           * @param {Object} context
           * @param {Object} action
           */
          doAction: /* @__PURE__ */ __name(function(context, action) {
            switch (action.type) {
              case "replace":
              case "encapsulate": {
                if (context.$textarea.prop("readonly")) {
                  break;
                }
                const parts = {
                  pre: action.options.pre,
                  peri: action.options.peri,
                  post: action.options.post
                };
                let replace = action.type === "replace";
                if ("regex" in action.options && "regexReplace" in action.options) {
                  const selection = context.$textarea.textSelection("getSelection");
                  if (selection !== "" && action.options.regex.test(selection)) {
                    parts.peri = selection.replace(
                      action.options.regex,
                      action.options.regexReplace
                    );
                    parts.pre = parts.post = "";
                    replace = true;
                  }
                }
                context.$textarea.textSelection(
                  "encapsulateSelection",
                  Object.assign({}, action.options, parts, { replace })
                );
                break;
              }
              case "callback":
                if (typeof action.execute === "function") {
                  action.execute(context);
                }
                break;
              case "dialog":
                context.fn.saveSelection();
                context.$textarea.wikiEditor("openDialog", action.module);
                break;
              default:
                break;
            }
          }, "doAction"),
          buildGroup: /* @__PURE__ */ __name(function(context, id, group) {
            const $group = $("<div>").attr({ class: "group group-" + id, rel: id }), label = group.label;
            if (label) {
              $("<span>").addClass("label").text(label).appendTo($group);
            }
            let empty = true;
            if ("tools" in group) {
              for (const tool in group.tools) {
                const $tool = toolbarModule.fn.buildTool(context, tool, group.tools[tool]);
                if ($tool) {
                  empty = empty && $tool.css("display") === "none";
                  $group.append($tool);
                }
              }
            }
            if (empty) {
              $group.addClass("empty");
            }
            return $group;
          }, "buildGroup"),
          buildTool: /* @__PURE__ */ __name(function(context, id, tool) {
            if ("filters" in tool) {
              for (let i = 0; i < tool.filters.length; i++) {
                if ($(tool.filters[i]).length === 0) {
                  return null;
                }
              }
            }
            const label = tool.label;
            switch (tool.type) {
              case "button":
              case "toggle": {
                let $button;
                if (tool.oouiIcon) {
                  const config = {
                    framed: false,
                    classes: ["tool"],
                    icon: tool.oouiIcon,
                    title: this.buildShortcutLabel(label, tool.hotkey)
                  };
                  let oouiButton;
                  if (tool.type === "button") {
                    oouiButton = new OO.ui.ButtonWidget(config);
                  } else if (tool.type === "toggle") {
                    oouiButton = new OO.ui.ToggleButtonWidget(config);
                  }
                  $button = oouiButton.$element.attr("rel", id).data("ooui", oouiButton);
                } else {
                  $button = $("<a>").attr({
                    tabindex: 0,
                    title: label,
                    rel: id,
                    role: "button",
                    class: "tool tool-button"
                  }).text(label);
                  if (tool.icon) {
                    const icon = $.wikiEditor.autoIcon(
                      tool.icon,
                      $.wikiEditor.imgPath + "toolbar/"
                    );
                    $button.css("background-image", "url(" + icon + ")");
                  }
                }
                $button.data("setActive", (active) => {
                  $button.toggleClass("tool-active", active);
                  if ($button.data("ooui") && tool.type === "toggle") {
                    $button.data("ooui").setValue(active);
                    if (OO.ui.WikimediaUITheme && OO.ui.theme instanceof OO.ui.WikimediaUITheme) {
                      setTimeout(() => {
                        $button.data("ooui").$icon.toggleClass("oo-ui-image-progressive", active);
                      });
                    }
                  }
                });
                if ("action" in tool) {
                  $button.data("action", tool.action).data("context", context).on("mousedown", (e) => {
                    e.preventDefault();
                    return false;
                  });
                  if ($button.data("ooui")) {
                    $button.data("ooui").on("click", () => {
                      toolbarModule.fn.doAction(
                        context,
                        tool.action
                      );
                    });
                  } else {
                    $button.on("click keydown", (e) => {
                      if (e.type === "click" || e.type === "keydown" && e.key === "Enter") {
                        toolbarModule.fn.doAction(
                          context,
                          tool.action
                        );
                        e.preventDefault();
                        return false;
                      }
                    });
                  }
                  if ("hotkey" in tool) {
                    toolbarModule.fn.ctrlShortcuts[tool.hotkey] = tool;
                  }
                }
                return $button;
              }
              case "select": {
                const menuId = "menu-" + Date.now();
                const $select = $("<div>").attr({ rel: id, class: "tool tool-select" });
                const $options = $("<div>").addClass("options");
                if ("list" in tool) {
                  for (const option in tool.list) {
                    const optionLabel = tool.list[option].label;
                    $options.append(
                      $("<a>").data("action", tool.list[option].action).data("context", context).on("mousedown", (e) => {
                        e.preventDefault();
                        return false;
                      }).on("click keydown", (e) => {
                        if (e.type === "click" || e.type === "keydown" && e.key === "Enter") {
                          const $link = $(e.target);
                          toolbarModule.fn.doAction(
                            $link.data("context"),
                            $link.data("action"),
                            $link
                          );
                          $link.closest(".tool-select").removeClass("options-shown");
                          e.preventDefault();
                          return false;
                        }
                      }).text(optionLabel).addClass("option").attr({ rel: option, tabindex: 0, role: "menuitem" })
                    );
                  }
                }
                $select.append(
                  $("<a>").addClass("label skin-invert").text(label).data("options", $options).attr({ role: "button", tabindex: 0, "aria-expanded": false, "aria-controls": menuId, "aria-haspopup": "menu" }).on("mousedown", (e) => {
                    e.preventDefault();
                    return false;
                  }).on("click keydown", (e) => {
                    if (e.type === "click" || e.type === "keydown" && e.key === "Enter") {
                      const $link = $(e.target);
                      const $opts = $link.data("options");
                      const canShowOptions = !$opts.closest(".tool-select").hasClass("options-shown");
                      $opts.closest(".tool-select").toggleClass("options-shown", canShowOptions);
                      $link.attr("aria-expanded", canShowOptions.toString());
                      e.preventDefault();
                      return false;
                    }
                  })
                );
                $select.append($("<div>").addClass("menu").append($options));
                return $select;
              }
              case "element": {
                let $element;
                if (tool.element instanceof OO.ui.HtmlSnippet) {
                  $element = tool.element.toString();
                } else if (typeof tool.element === "function") {
                  $element = tool.element(context);
                } else {
                  $element = tool.element;
                }
                return $("<div>").attr({ rel: id, class: "tool tool-element" }).append($element);
              }
              default:
                return null;
            }
          }, "buildTool"),
          buildBookmark: /* @__PURE__ */ __name(function(context, id, page) {
            const label = page.label;
            const $bookmark = $("<div>");
            return $bookmark.text(label).attr({
              rel: id,
              role: "option"
            }).data("context", context).on("mousedown", (e) => {
              e.preventDefault();
              return false;
            }).on("click", (event) => {
              $bookmark.parent().parent().find(".page").hide();
              $bookmark.parent().parent().find(".page-" + $bookmark.attr("rel")).show().trigger("loadPage");
              $bookmark.addClass("current").siblings().removeClass("current");
              const section = $bookmark.parent().parent().attr("rel");
              $.cookie(
                "wikiEditor-" + $bookmark.data("context").instance + "-booklet-" + section + "-page",
                $bookmark.attr("rel"),
                { expires: 30, path: "/" }
              );
              event.preventDefault();
              return false;
            });
          }, "buildBookmark"),
          buildPage: /* @__PURE__ */ __name(function(context, id, page, deferLoad) {
            const $page = $("<div>").attr({
              class: "page page-" + id,
              rel: id
            });
            if (deferLoad) {
              if (id === "recent") {
                $page.on("loadPage", () => {
                  try {
                    page.characters = JSON.parse(localStorage.get(`wikieditor-${RECENTKEY}`) || "[]");
                  } catch (e) {
                    page.characters = [];
                  }
                  toolbarModule.fn.reallyBuildPage(context, id, page, $page);
                });
              } else {
                $page.one("loadPage", () => {
                  toolbarModule.fn.reallyBuildPage(context, id, page, $page);
                });
              }
            } else {
              toolbarModule.fn.reallyBuildPage(context, id, page, $page);
            }
            return $page;
          }, "buildPage"),
          reallyBuildPage: /* @__PURE__ */ __name(function(context, id, page, $page) {
            switch (page.layout) {
              case "table": {
                const $table = $("<table>").addClass("table-" + id);
                if ("headings" in page) {
                  $table.append(toolbarModule.fn.buildHeading(context, page.headings));
                }
                if ("rows" in page) {
                  for (let i = 0; i < page.rows.length; i++) {
                    $table.append(toolbarModule.fn.buildRow(context, page.rows[i]));
                  }
                }
                $page.addClass("page-table").append($table);
                break;
              }
              case "characters": {
                $page.addClass("page-characters");
                const $characters = $("<div>").data("context", context).data("actions", {});
                const actions = $characters.data("actions");
                if ("language" in page) {
                  $characters.attr("lang", page.language);
                }
                if ("direction" in page) {
                  $characters.attr("dir", page.direction);
                } else {
                  $characters.attr("dir", "ltr");
                }
                if ("characters" in page) {
                  for (let i = 0; i < page.characters.length; i++) {
                    $characters.append(
                      toolbarModule.fn.buildCharacter(page.characters[i], actions)
                    );
                  }
                  $characters.children().attr("role", "option").on("mousedown", (e) => {
                    e.preventDefault();
                    return false;
                  }).on("click", (e) => {
                    const $character = $(e.target);
                    let clickActions = actions[$character.attr("rel")];
                    if (!Array.isArray(clickActions)) {
                      clickActions = [clickActions];
                    }
                    for (const action of clickActions) {
                      toolbarModule.fn.doAction(
                        context,
                        action
                      );
                    }
                    e.preventDefault();
                    return false;
                  });
                }
                $page.empty();
                $page.append($characters);
                break;
              }
            }
          }, "reallyBuildPage"),
          buildHeading: /* @__PURE__ */ __name(function(context, headings) {
            const $row = $("<tr>");
            for (let i = 0; i < headings.length; i++) {
              if (!headings[i].msg) {
                console.warn("The toolbar headings must use a `msg` key with a `__wikieditor_i18n` key as value. Other keys are deprecated.");
              }
              $row.append(
                headings[i].msg ? (
                  // eslint-disable-next-line mediawiki/msg-doc
                  $("<th>").append(__wikieditor_i18n2(headings[i].msg).parseDom())
                ) : (
                  // Deprecated backward compatibility
                  $("<th>").html($.wikiEditor.autoSafeMsg(headings[i], ["html", "text"]))
                )
              );
            }
            return $row;
          }, "buildHeading"),
          buildRow: /* @__PURE__ */ __name(function(context, row) {
            const $row = $("<tr>");
            for (const cell in row) {
              $row.append(
                // The following classes are used here:
                // * cell-description
                // * cell-syntax
                // * cell-result
                $("<td>").addClass("cell cell-" + cell).append(
                  $("<span>").html(row[cell].html)
                )
              );
            }
            return $row;
          }, "buildRow"),
          buildCharacter: /* @__PURE__ */ __name(function(character, actions) {
            const configRepresentation = character;
            if (typeof character === "string") {
              character = {
                label: character,
                action: {
                  type: "replace",
                  options: {
                    peri: character,
                    selectPeri: false
                  }
                },
                configRepresentation
              };
            } else if (character && 0 in character && 1 in character) {
              character = {
                label: character[0],
                action: {
                  type: "replace",
                  options: {
                    peri: character[1],
                    selectPeri: false
                  }
                },
                configRepresentation
              };
            }
            if (character && "action" in character && "label" in character) {
              const updateRecentAction = {
                type: "callback",
                character,
                execute: /* @__PURE__ */ __name(function() {
                  const maxRecentlyUsed = 32;
                  let cache;
                  try {
                    cache = JSON.parse(localStorage.get(`wikieditor-${RECENTKEY}`) || "[]");
                  } catch (e) {
                    cache = [];
                  }
                  const storeAs = this.character.configRepresentation ? this.character.configRepresentation : this.character;
                  const i = cache.findIndex((item) => JSON.stringify(storeAs) === JSON.stringify(item));
                  if (i !== -1) {
                    cache.splice(i, 1);
                  }
                  cache.unshift(storeAs);
                  cache = cache.slice(0, maxRecentlyUsed);
                  localStorage.set(`wikieditor-${RECENTKEY}`, JSON.stringify(cache));
                }, "execute")
              };
              actions[character.label] = [
                character.action,
                updateRecentAction
              ];
              const title = character.titleMsg ? __wikieditor_i18n2(character.titleMsg) : character.title;
              return $("<span>").attr({
                rel: character.label,
                title
              }).text(character.label);
            }
            console.log("A character for the toolbar was undefined. This is not supposed to happen. Double check the config.");
            return $();
          }, "buildCharacter"),
          buildTab: /* @__PURE__ */ __name(function(context, id, section) {
            const selected = $.cookie("wikiEditor-" + context.instance + "-toolbar-section");
            if (selected !== null) {
              $.cookie("wikiEditor-" + context.instance + "-toolbar-section", selected, { expires: 30, path: "/" });
            }
            const $link = $("<a>").addClass(selected === id ? "current" : null).addClass("skin-invert").attr({
              tabindex: 0,
              role: "button",
              "aria-expanded": (selected === id).toString(),
              "aria-controls": "wikiEditor-section-" + id
            }).text(section.label).data("context", context).on("mouseup", () => {
              $link.trigger("blur");
            }).on("mousedown", (e) => {
              e.preventDefault();
              return false;
            }).on("click keydown", (e) => {
              if (e.type !== "click" && (e.type !== "keydown" || e.key !== "Enter")) {
                return;
              }
              $link.attr("aria-pressed", "true");
              $(".tab > a").each((i, elem) => {
                if (elem !== e.target) {
                  $(elem).attr("aria-pressed", "false");
                }
              });
              const $sections = $link.data("context").$ui.find(".sections");
              const $section = $sections.find(".section-" + $link.parent().attr("rel"));
              const show = !$section.hasClass("section-visible");
              $sections.find(".section-visible").removeClass("section-visible").addClass("section-hidden");
              $link.attr("aria-expanded", "false").parent().parent().find("a").removeClass("current");
              if (show) {
                $section.removeClass("section-hidden").attr("aria-expanded", "true").addClass("section-visible");
                $link.attr("aria-expanded", "true").addClass("current");
              }
              $.cookie(
                "wikiEditor-" + $link.data("context").instance + "-toolbar-section",
                show ? $section.attr("rel") : null,
                { expires: 30, path: "/" }
              );
              e.preventDefault();
              return false;
            });
            return $("<span>").attr({
              class: "tab tab-" + id,
              rel: id
            }).append($link);
          }, "buildTab"),
          buildSection: /* @__PURE__ */ __name(function(context, id, section) {
            const $section = $("<div>").attr({
              class: section.type + " section section-" + id,
              rel: id,
              id: "wikiEditor-section-" + id
            });
            const selected = $.cookie("wikiEditor-" + context.instance + "-toolbar-section");
            const show = selected === id;
            toolbarModule.fn.reallyBuildSection(context, id, section, $section, section.deferLoad);
            if (id !== "main" && id !== "secondary") {
              $section.attr("aria-expanded", show.toString()).addClass(show ? "section-visible" : "section-hidden");
            }
            return $section;
          }, "buildSection"),
          reallyBuildSection: /* @__PURE__ */ __name(function(context, id, section, $section, deferLoad) {
            context.$textarea.trigger("wikiEditor-toolbar-buildSection-" + $section.attr("rel"), [section]);
            switch (section.type) {
              case "toolbar": {
                if ("groups" in section) {
                  for (const group in section.groups) {
                    $section.append(
                      toolbarModule.fn.buildGroup(context, group, section.groups[group])
                    );
                  }
                }
                break;
              }
              case "booklet": {
                const $pages = $("<div>").addClass("pages").attr({
                  tabindex: "0",
                  role: "listbox"
                }).on("keydown", (event) => {
                  const $selected = $pages.children().filter(function() {
                    return $(this).css("display") !== "none";
                  });
                  $.wikiEditor.modules.toolbar.fn.handleKeyDown($selected.children().first(), event, $pages);
                });
                const $index = $("<div>").addClass("index").attr({
                  tabindex: "0",
                  role: "listbox"
                }).on("keydown", (event) => {
                  $.wikiEditor.modules.toolbar.fn.handleKeyDown($index, event, $index);
                });
                if ("pages" in section) {
                  for (const page in section.pages) {
                    $pages.append(
                      toolbarModule.fn.buildPage(context, page, section.pages[page], deferLoad)
                    );
                    $index.append(
                      toolbarModule.fn.buildBookmark(context, page, section.pages[page])
                    );
                  }
                }
                $section.append($index, $pages);
                toolbarModule.fn.updateBookletSelection(context, id, $pages, $index);
                break;
              }
            }
          }, "reallyBuildSection"),
          updateBookletSelection: /* @__PURE__ */ __name(function(context, id, $pages, $index) {
            const cookie = "wikiEditor-" + context.instance + "-booklet-" + id + "-page";
            let selected = $.cookie(cookie);
            if (selected !== null) {
              $.cookie(cookie, selected, { expires: 30, path: "/" });
            }
            let $selectedIndex = $index.find('*[rel="' + selected + '"]');
            if ($selectedIndex.length === 0) {
              $selectedIndex = $index.children().eq(0);
              selected = $selectedIndex.attr("rel");
            }
            $pages.children().hide();
            $pages.find('*[rel="' + selected + '"]').show().trigger("loadPage");
            $index.children().removeClass("current");
            $selectedIndex.addClass("current");
          }, "updateBookletSelection"),
          build: /* @__PURE__ */ __name(function(context, config) {
            const $tabs = $("<div>").addClass("tabs").appendTo(context.modules.toolbar.$toolbar), $sections = $("<div>").addClass("sections").appendTo(context.modules.toolbar.$toolbar);
            context.modules.toolbar.$toolbar.append($("<div>").css("clear", "both"));
            for (const section in config) {
              if (section === "main" || section === "secondary") {
                context.modules.toolbar.$toolbar.prepend(
                  toolbarModule.fn.buildSection(context, section, config[section])
                );
              } else {
                $sections.append(toolbarModule.fn.buildSection(context, section, config[section]));
                $tabs.append(toolbarModule.fn.buildTab(context, section, config[section]));
              }
            }
            setTimeout(() => {
              context.$textarea.trigger("wikiEditor-toolbar-doneInitialSections");
            });
            toolbarModule.fn.setupShortcuts(context);
          }, "build"),
          ctrlShortcuts: {},
          setupShortcuts: /* @__PURE__ */ __name(function(context) {
            context.$textarea.on("keydown", (e) => {
              const modifier = this.modifierForKey(e.key);
              const otherModifier = modifier === "ctrlKey" ? "metaKey" : "ctrlKey";
              const target = e[modifier] && !e[otherModifier] && !e.altKey && !e.shiftKey && (toolbarModule.fn.ctrlShortcuts[e.key] || toolbarModule.fn.ctrlShortcuts[e.which]);
              if (target) {
                e.preventDefault();
                toolbarModule.fn.doAction(context, target.action);
              }
            });
          }, "setupShortcuts"),
          buildShortcutLabel: /* @__PURE__ */ __name(function(label, key) {
            if (typeof key !== "string") {
              return label;
            }
            const modifier = this.modifierForKey(key) === "ctrlKey" ? "ctrl+" : "\u2318";
            const separatorMsg = __wikieditor_i18n2("word-separator").plain();
            const parts = (separatorMsg + __wikieditor_i18n2("brackets").plain()).split("$1");
            const regexp = new RegExp(parts.map(escape).join(".*?") + "$");
            return label.replace(regexp, "") + separatorMsg + __wikieditor_i18n2("brackets", modifier + key).plain();
          }, "buildShortcutLabel"),
          modifierForKey: /* @__PURE__ */ __name(function(key) {
            const profile = $.client.profile();
            if (profile.name === "safari" && key === ",") {
              return "ctrlKey";
            }
            return profile.platform === "mac" ? "metaKey" : "ctrlKey";
          }, "modifierForKey"),
          handleKeyDown: /* @__PURE__ */ __name(function($element, event, $parent) {
            const $currentItem = $element.find(".wikiEditor-character-highlighted"), optionOffset = $parent.find(".wikiEditor-character-highlighted").offset(), optionTop = optionOffset ? optionOffset.top : 0, selectTop = $parent.offset().top;
            let $nextItem;
            switch (event.keyCode) {
              // Up arrow
              case 38:
                if ($currentItem.length) {
                  $currentItem.removeClass("wikiEditor-character-highlighted");
                  $nextItem = $currentItem.prev();
                  $nextItem = $nextItem.length ? $nextItem : $currentItem;
                  $nextItem.addClass("wikiEditor-character-highlighted");
                } else {
                  $element.children().first().addClass("wikiEditor-character-highlighted");
                }
                event.preventDefault();
                event.stopPropagation();
                break;
              // Down arrow
              case 40:
                if ($currentItem.length) {
                  $currentItem.removeClass("wikiEditor-character-highlighted");
                  $nextItem = $currentItem.next();
                  $nextItem = $nextItem.length ? $nextItem : $currentItem;
                  $nextItem.addClass("wikiEditor-character-highlighted");
                } else {
                  $element.children().first().addClass("wikiEditor-character-highlighted");
                }
                event.preventDefault();
                event.stopPropagation();
                break;
              // Enter
              case 13:
                $currentItem.trigger("click");
                break;
            }
            $parent.scrollTop($parent.scrollTop() + (optionTop - selectTop));
          }, "handleKeyDown")
        }
      };
      module.exports = toolbarModule;
    }
  });

  // jquery.wikiEditor.dialogs.js
  var require_jquery_wikiEditor_dialogs = __commonJS({
    "jquery.wikiEditor.dialogs.js"(exports, module) {
      var __wikieditor_i18n2 = require_ext_wikiEditor_i18n().i18n;
      var dialogsModule = {
        /**
         * API accessible functions
         */
        api: {
          addDialog: /* @__PURE__ */ __name(function(context, data) {
            dialogsModule.fn.create(context, data);
          }, "addDialog"),
          openDialog: /* @__PURE__ */ __name(function(context, module2) {
            if (module2 in dialogsModule.modules) {
              const mod = dialogsModule.modules[module2];
              let $dialog = $("#" + mod.id);
              if ($dialog.length === 0) {
                dialogsModule.fn.reallyCreate(context, mod, module2);
                $dialog = $("#" + mod.id);
              }
              $dialog.closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-state-focus");
              $dialog.dialog("open");
            }
          }, "openDialog"),
          closeDialog: /* @__PURE__ */ __name(function(context, module2) {
            if (module2 in dialogsModule.modules) {
              $("#" + dialogsModule.modules[module2].id).dialog("close");
            }
          }, "closeDialog")
        },
        /**
         * Internally used functions
         */
        fn: {
          /**
           * Creates a dialog module within a wikiEditor
           *
           * @param {Object} context Context object of editor to create module in
           * @param {Object} config Configuration object to create module from
           */
          create: /* @__PURE__ */ __name(function(context, config) {
            for (const mod in config) {
              const module2 = config[mod];
              let filtered = false;
              if (typeof module2.filters !== "undefined") {
                for (let i = 0; i < module2.filters.length; i++) {
                  if ($(module2.filters[i]).length === 0) {
                    filtered = true;
                    break;
                  }
                }
              }
              let $existingDialog = $("#" + module2.id);
              if ($existingDialog.length > 0 && $existingDialog.data("context").$textarea !== context.$textarea) {
                $existingDialog.remove();
              }
              $existingDialog = $("#" + module2.id);
              if (!filtered && $existingDialog.length === 0) {
                dialogsModule.modules[mod] = module2;
                context.$textarea.trigger("wikiEditor-dialogs-setup-" + mod);
                if (typeof module2.immediateCreate !== "undefined" && module2.immediateCreate) {
                  dialogsModule.fn.reallyCreate(context, module2, mod);
                }
              }
            }
          }, "create"),
          /**
           * Build the actual dialog. This done on-demand rather than in create()
           *
           * @param {Object} context Context object of editor dialog belongs to
           * @param {Object} module Dialog module object
           * @param {string} name Dialog name (key in dialogsModule.modules)
           */
          reallyCreate: /* @__PURE__ */ __name(function(context, module2, name) {
            const configuration = module2.dialog;
            configuration.bgiframe = true;
            configuration.autoOpen = false;
            if (typeof configuration.modal === "undefined") {
              configuration.modal = true;
            }
            if (false) {
              configuration.title = module2.title.parseDom();
            } else {
              console.warn("The dialog title must be a mw.Message object. Other types are deprecated.");
              configuration.title = module2.title;
            }
            configuration.newButtons = {};
            for (const msg in configuration.buttons) {
              configuration.newButtons[__wikieditor_i18n2(msg)] = configuration.buttons[msg];
            }
            configuration.buttons = configuration.newButtons;
            let $content;
            if (false) {
              $content = mw.template.get("ext.wikiEditor", module2.htmlTemplate).render();
            } else if (module2.html instanceof $) {
              $content = module2.html;
            } else {
              $content = $($.parseHTML(module2.html));
            }
            const $dialogDiv = $("<div>").attr("id", module2.id).append($content).data("context", context).appendTo(document.body).each(module2.init).dialog(configuration);
            $dialogDiv.on("dialogclose", () => {
              context.fn.restoreSelection();
            });
            context.$textarea.trigger("wikiEditor-dialogs-loaded-" + name);
          }, "reallyCreate")
        },
        // This stuff is just hanging here, perhaps we could come up with a better home for this stuff
        modules: {},
        quickDialog: /* @__PURE__ */ __name(function(body, settings) {
          $("<div>").text(body).appendTo(document.body).dialog(Object.assign({
            bgiframe: true,
            modal: true
          }, settings)).dialog("open");
        }, "quickDialog")
      };
      module.exports = dialogsModule;
    }
  });

  // jquery.wikiEditor.js
  var require_jquery_wikiEditor = __commonJS({
    "jquery.wikiEditor.js"() {
      var __wikieditor_i18n2 = require_ext_wikiEditor_i18n().i18n;
      var hasOwn = Object.prototype.hasOwnProperty;
      var fallbackChain = (function() {
        const isRTL = $(document.body).hasClass("rtl"), chain = ["en"];
        if (chain.length >= 2 && !/^en-/.test(chain[chain.length - 2])) {
          chain.pop();
        }
        if (isRTL) {
          chain.push("default-rtl");
        }
        chain.push("default");
        return chain;
      })();
      function deprecateAutoMsg(property, key) {
        const searchParam = false ? "insource:/" + property + "Msg: '" + key + "'/" : property + "Msg: " + key;
        let searchUri = "/";
        if (searchUri.slice(0, 2) === "//") {
          searchUri = location.protocol + searchUri;
        }
        let messageMethod;
        if (property === "html" || property === "text" || property === "title") {
          messageMethod = "__wikieditor_i18n( " + JSON.stringify(key) + " ).parse()";
        } else {
          messageMethod = "__wikieditor_i18n( " + JSON.stringify(key) + " )";
        }
        const deprecationMsg = /* @__PURE__ */ __name(() => {
          console.log(
            "wikiEditor_autoMsg",
            "WikiEditor: Use `" + property + ": " + messageMethod + "` instead of `" + property + "Msg: " + JSON.stringify(key) + "`.\nSearch: " + searchUri
          );
        }, "deprecationMsg");
        deprecationMsg();
      }
      __name(deprecateAutoMsg, "deprecateAutoMsg");
      $.wikiEditor = {
        /**
         * For each module that is loaded, static code shared by all instances is loaded into this object organized by
         * module name. The existence of a module in this object only indicates the module is available. To check if a
         * module is in use by a specific context check the context.modules object.
         */
        modules: {
          toolbar: require_jquery_wikiEditor_toolbar(),
          dialogs: require_jquery_wikiEditor_dialogs()
        },
        /**
         * A context can be extended, such as adding iframe support, on a per-wikiEditor instance basis.
         */
        extensions: {},
        /**
         * In some cases like with the iframe's HTML file, it's convenient to have a lookup table of all instances of the
         * WikiEditor. Each context contains an instance field which contains a key that corresponds to a reference to the
         * textarea which the WikiEditor was build around. This way, by passing a simple integer you can provide a way back
         * to a specific context.
         */
        instances: [],
        /**
         * Path to images - this is a bit messy, and it would need to change if this code (and images) gets moved into the
         * core - or anywhere for that matter...
         */
        imgPath: "./images/",
        /**
         * Checks if a module has a specific requirement
         *
         * @param {Object} module Module object
         * @param {string} requirement String identifying requirement
         * @return {boolean}
         */
        isRequired: /* @__PURE__ */ __name(function(module2, requirement) {
          if (typeof module2.req !== "undefined") {
            for (const req in module2.req) {
              if (module2.req[req] === requirement) {
                return true;
              }
            }
          }
          return false;
        }, "isRequired"),
        /**
         * Provides a way to extract messages from objects. Wraps a __wikieditor_i18n( ... ).text() call.
         *
         * FIXME: This is a security nightmare. Only use is for the help toolbar panel. Inline the
         *        special need instead?
         * FIXME: Also, this is ludicrously complex. Just use __wikieditor_i18n().text() directly.
         *
         * @deprecated Since v0.5.4. Use __wikieditor_i18n() directly instead of <key>Msg
         *
         * @param {Object} object Object to extract messages from
         * @param {string} property String of name of property which contains the message. This should be the base name of the
         * property, which means that in the case of the object { this: 'that', fooMsg: 'bar' }, passing property as 'this'
         * would return the raw text 'that', while passing property as 'foo' would return the internationalized message
         * with the key 'bar'.
         * @return {string}
         */
        autoMsg: /* @__PURE__ */ __name(function(object, property) {
          console.warn("autoMsg is deprecated. Use __wikieditor_i18n() instead.");
          if (typeof property === "object") {
            for (const i in property) {
              if (property[i] in object || property[i] + "Msg" in object) {
                property = property[i];
                break;
              }
            }
          }
          if (property in object) {
            return object[property];
          } else if (property + "Msg" in object) {
            const p = object[property + "Msg"];
            if (Array.isArray(p) && p.length >= 2) {
              deprecateAutoMsg(property, p[0]);
              return __wikieditor_i18n2.apply(__wikieditor_i18n2, p).text();
            } else {
              deprecateAutoMsg(property, p);
              return __wikieditor_i18n2(p).text();
            }
          } else {
            return "";
          }
        }, "autoMsg"),
        /**
         * Provides a way to extract messages from objects. Wraps a __wikieditor_i18n( ... ).escaped() call.
         *
         * FIXME: This is ludicrously complex. Just use __wikieditor_i18n().escaped() directly.
         *
         * @deprecated Since v0.5.4. Use __wikieditor_i18n() directly instead of <key>Msg
         *
         * @param {Object} object Object to extract messages from
         * @param {string} property String of name of property which contains the message. This should be the base name of the
         * property, which means that in the case of the object { this: 'that', fooMsg: 'bar' }, passing property as 'this'
         * would return the raw text 'that', while passing property as 'foo' would return the internationalized message
         * with the key 'bar'. This is then escaped.
         * @return {string}
         */
        autoSafeMsg: /* @__PURE__ */ __name(function(object, property) {
          consolee.warn("autoSafeMsg is deprecated. Use __wikieditor_i18n() instead.");
          if (typeof property === "object") {
            for (const i in property) {
              if (property[i] in object || property[i] + "Msg" in object) {
                property = property[i];
                break;
              }
            }
          }
          if (property in object) {
            return object[property];
          } else if (property + "Msg" in object) {
            const p = object[property + "Msg"];
            if (Array.isArray(p) && p.length >= 2) {
              deprecateAutoMsg(property, p[0]);
              return __wikieditor_i18n2.apply(__wikieditor_i18n2, p).escaped();
            } else {
              deprecateAutoMsg(property, p);
              return __wikieditor_i18n2(p).escaped();
            }
          } else {
            return "";
          }
        }, "autoSafeMsg"),
        /**
         * Provides a way to extract a property of an object in a certain language, falling back on the property keyed as
         * 'default' or 'default-rtl'. If such key doesn't exist, the object itself is considered the actual value, which
         * should ideally be the case so that you may use a string or object of any number of strings keyed by language
         * with a default.
         *
         * @param {Object} object Object to extract property from
         * @return {Object}
         */
        autoLang: /* @__PURE__ */ __name(function(object) {
          for (let i = 0; i < fallbackChain.length; i++) {
            const key = fallbackChain[i];
            if (hasOwn.call(object, key)) {
              return object[key];
            }
          }
          return object;
        }, "autoLang"),
        /**
         * Provides a way to extract the path of an icon in a certain language, automatically appending a version number for
         * caching purposes and prepending an image path when icon paths are relative.
         *
         * @param {Object} icon Icon object from e.g. toolbar config
         * @param {string} path Default icon path, defaults to $.wikiEditor.imgPath
         * @return {Object}
         */
        autoIcon: /* @__PURE__ */ __name(function(icon, path) {
          path = path || $.wikiEditor.imgPath;
          for (let i = 0; i < fallbackChain.length; i++) {
            const key = fallbackChain[i];
            if (icon && hasOwn.call(icon, key)) {
              let src = icon[key];
              if (src.slice(0, 5) === "data:") {
                return src;
              }
              if (src.slice(0, 7) !== "http://" && src.slice(0, 8) !== "https://" && src[0] !== "/") {
                src = path + src;
              }
              return src;
            }
          }
          return icon;
        }, "autoIcon")
      };
      $.fn.wikiEditor = function() {
        let context = $(this).data("wikiEditor-context");
        if (!context) {
          context = {
            // Reference to the textarea element which the wikiEditor is being built around
            $textarea: $(this),
            // Reference to the focused element before the dialog opens, so it can be restored once it closes
            $focusedElem: null,
            // Container for any number of mutually exclusive views that are accessible by tabs
            views: {},
            // Container for any number of module-specific data - only including data for modules in use on this context
            modules: {},
            // General place to shove bits of data into
            data: {},
            // Unique numeric ID of this instance used both for looking up and differentiating instances of wikiEditor
            instance: $.wikiEditor.instances.push($(this)) - 1,
            // Saved selection state for old IE (<=10)
            savedSelection: null,
            // List of extensions active on this context
            extensions: []
          };
          context.api = {
            /*!
             * Activates a module on a specific context with optional configuration data.
             *
             * @param data Either a string of the name of a module to add without any additional configuration parameters,
             * or an object with members keyed with module names and valued with configuration objects.
             */
            addModule: /* @__PURE__ */ __name(function(ctx, data) {
              let modules = {};
              if (typeof data === "string") {
                modules[data] = {};
              } else if (typeof data === "object") {
                modules = data;
              }
              for (const module2 in modules) {
                if (typeof module2 === "string" && typeof $.wikiEditor.modules[module2] !== "undefined") {
                  if ("api" in $.wikiEditor.modules[module2]) {
                    for (const call in $.wikiEditor.modules[module2].api) {
                      if (!(call in ctx.api)) {
                        ctx.api[call] = $.wikiEditor.modules[module2].api[call];
                      }
                    }
                  }
                  if ("fn" in $.wikiEditor.modules[module2] && "create" in $.wikiEditor.modules[module2].fn && typeof ctx.modules[module2] === "undefined") {
                    ctx.modules[module2] = {};
                    $.wikiEditor.modules[module2].fn.create(ctx, modules[module2]);
                  }
                }
              }
            }, "addModule")
          };
          context.evt = {
            /* Empty until extensions add some; see jquery.wikiEditor.iframe.js for examples. */
          };
          context.fn = {
            /**
             * Executes core event filters as well as event handlers provided by modules.
             *
             * @param {string} name
             * @param {Object} event
             * @return {boolean}
             */
            trigger: /* @__PURE__ */ __name(function(name, event) {
              event = event || { type: "custom" };
              event.data = event.data || {};
              if (name in context.evt) {
                if (!context.evt[name](event)) {
                  return false;
                }
              }
              let returnFromModules = true;
              for (const module2 in context.modules) {
                if (module2 in $.wikiEditor.modules && "evt" in $.wikiEditor.modules[module2] && name in $.wikiEditor.modules[module2].evt) {
                  const ret = $.wikiEditor.modules[module2].evt[name](context, event);
                  if (ret !== null) {
                    returnFromModules = returnFromModules && ret;
                  }
                }
              }
              return returnFromModules;
            }, "trigger"),
            /**
             * Save text selection
             */
            saveSelection: /* @__PURE__ */ __name(function() {
              context.$focusedElem = $(":focus");
              context.$textarea.trigger("focus");
              context.savedSelection = context.$textarea.textSelection("getCaretPosition", { startAndEnd: true });
            }, "saveSelection"),
            /**
             * Restore text selection
             */
            restoreSelection: /* @__PURE__ */ __name(function() {
              if (context.savedSelection) {
                context.$textarea.trigger("focus");
                context.$textarea.textSelection("setSelection", { start: context.savedSelection[0], end: context.savedSelection[1] });
                context.savedSelection = null;
              }
              if (context.$focusedElem) {
                context.$focusedElem.trigger("focus");
              }
            }, "restoreSelection")
          };
          const hasFocus = context.$textarea.is(":focus");
          const cursorPos = context.$textarea.textSelection("getCaretPosition", { startAndEnd: true });
          context.$textarea.wrapAll($("<div>").addClass("wikiEditor-ui")).wrapAll($("<div>").addClass("wikiEditor-ui-view")).wrapAll($("<div>").addClass("wikiEditor-ui-left")).wrapAll($("<div>").addClass("wikiEditor-ui-bottom")).wrapAll($("<div>").addClass("wikiEditor-ui-text"));
          context.$textarea.prop("scrollTop", $("#wpScrolltop").val());
          if (hasFocus) {
            context.$textarea.trigger("focus");
            context.$textarea.textSelection("setSelection", { start: cursorPos[0], end: cursorPos[1] });
          }
          context.$ui = context.$textarea.parent().parent().parent().parent().parent();
          context.$wikitext = context.$textarea.parent().parent().parent().parent();
          context.$ui.after($("<div>").addClass("wikiEditor-ui-clear"));
          context.$wikitext.append(
            $("<div>").addClass("wikiEditor-ui-right"),
            $("<div>").addClass("wikiEditor-ui-clear")
          );
          context.$wikitext.find(".wikiEditor-ui-left").prepend($("<div>").addClass("wikiEditor-ui-top"));
          context.view = "wikitext";
          $(window).on("resize", (event) => {
            context.fn.trigger("resize", event);
          });
        }
        const args = $.makeArray(arguments);
        if (args[0] === "addModule" && typeof args[1] !== "undefined") {
          let modulesArg = args[1];
          if (typeof modulesArg !== "object") {
            modulesArg = {};
            modulesArg[args[1]] = "";
          }
          for (const m in modulesArg) {
            if (m in $.wikiEditor.modules) {
              for (const extension in $.wikiEditor.extensions) {
                if ($.wikiEditor.isRequired($.wikiEditor.modules[m], extension) && !context.extensions.includes(extension)) {
                  context.extensions[context.extensions.length] = extension;
                  $.wikiEditor.extensions[extension](context);
                }
              }
              break;
            }
          }
        }
        if (args.length > 0) {
          const callArg = args.shift();
          if (callArg in context.api) {
            context.api[callArg](context, args[0] || {});
          }
        }
        return $(this).data("wikiEditor-context", context);
      };
    }
  });

  // data.json
  var require_data = __commonJS({
    "data.json"(exports, module) {
      module.exports = {
        magicWords: ["__TOC__", "__NOTOC__"],
        signature: "--\u53EF\u7231\u7684\u732B\u5A18~"
      };
    }
  });

  // jquery.wikiEditor.toolbar.config.js
  var require_jquery_wikiEditor_toolbar_config = __commonJS({
    "jquery.wikiEditor.toolbar.config.js"(exports, module) {
      function noErrGetter() {
        return new Proxy({}, { get: noErrGetter, set: /* @__PURE__ */ __name(() => {
        }, "set") });
      }
      __name(noErrGetter, "noErrGetter");
      var configData = require_data();
      var fileNamespace = "File";
      var specialCharacterGroups = noErrGetter.call();
      function delink($message) {
        const $div = $("<div>");
        $div.append($message);
        $div.find("a").attr("href", "#");
        return $div.html();
      }
      __name(delink, "delink");
      var toolbarConfig = {
        toolbar: {
          // Main section
          main: {
            type: "toolbar",
            groups: {
              format: {
                tools: {
                  bold: {
                    label: __wikieditor_i18n("wikieditor-toolbar-tool-bold"),
                    type: "button",
                    oouiIcon: "bold",
                    action: {
                      type: "encapsulate",
                      options: {
                        pre: "'''",
                        peri: __wikieditor_i18n("wikieditor-toolbar-tool-bold-example"),
                        post: "'''"
                      }
                    },
                    hotkey: "b"
                  },
                  italic: {
                    section: "main",
                    group: "format",
                    id: "italic",
                    label: __wikieditor_i18n("wikieditor-toolbar-tool-italic"),
                    type: "button",
                    oouiIcon: "italic",
                    action: {
                      type: "encapsulate",
                      options: {
                        pre: "''",
                        peri: __wikieditor_i18n("wikieditor-toolbar-tool-italic-example"),
                        post: "''"
                      }
                    },
                    hotkey: "i"
                  }
                }
              },
              insert: {
                tools: {
                  signature: {
                    label: __wikieditor_i18n("wikieditor-toolbar-tool-signature"),
                    type: "button",
                    oouiIcon: "signature",
                    action: {
                      type: "encapsulate",
                      options: {
                        pre: configData.signature
                      }
                    }
                  }
                }
              }
            }
          },
          // Secondary section of the top toolbar (at right side when LTR).
          secondary: {
            type: "toolbar",
            groups: {
              default: {
                tools: {}
              }
            }
          },
          // Format section
          advanced: {
            label: __wikieditor_i18n("wikieditor-toolbar-section-advanced"),
            type: "toolbar",
            groups: {
              heading: {
                tools: {
                  heading: {
                    label: __wikieditor_i18n("wikieditor-toolbar-tool-heading"),
                    type: "select",
                    list: {
                      "heading-2": {
                        label: __wikieditor_i18n("wikieditor-toolbar-tool-heading-2"),
                        action: {
                          type: "encapsulate",
                          options: {
                            pre: "== ",
                            peri: __wikieditor_i18n("wikieditor-toolbar-tool-heading-example"),
                            post: " ==",
                            regex: /^(\s*)(={1,6})(.*?)\2(\s*)$/,
                            regexReplace: "$1==$3==$4",
                            ownline: true
                          }
                        }
                      },
                      "heading-3": {
                        label: __wikieditor_i18n("wikieditor-toolbar-tool-heading-3"),
                        action: {
                          type: "encapsulate",
                          options: {
                            pre: "=== ",
                            peri: __wikieditor_i18n("wikieditor-toolbar-tool-heading-example"),
                            post: " ===",
                            regex: /^(\s*)(={1,6})(.*?)\2(\s*)$/,
                            regexReplace: "$1===$3===$4",
                            ownline: true
                          }
                        }
                      },
                      "heading-4": {
                        label: __wikieditor_i18n("wikieditor-toolbar-tool-heading-4"),
                        action: {
                          type: "encapsulate",
                          options: {
                            pre: "==== ",
                            peri: __wikieditor_i18n("wikieditor-toolbar-tool-heading-example"),
                            post: " ====",
                            regex: /^(\s*)(={1,6})(.*?)\2(\s*)$/,
                            regexReplace: "$1====$3====$4",
                            ownline: true
                          }
                        }
                      },
                      "heading-5": {
                        label: __wikieditor_i18n("wikieditor-toolbar-tool-heading-5"),
                        action: {
                          type: "encapsulate",
                          options: {
                            pre: "===== ",
                            peri: __wikieditor_i18n("wikieditor-toolbar-tool-heading-example"),
                            post: " =====",
                            regex: /^(\s*)(={1,6})(.*?)\2(\s*)$/,
                            regexReplace: "$1=====$3=====$4",
                            ownline: true
                          }
                        }
                      }
                    }
                  }
                }
              },
              format: {
                label: __wikieditor_i18n("wikieditor-toolbar-group-format"),
                tools: {
                  ulist: {
                    label: __wikieditor_i18n("wikieditor-toolbar-tool-ulist"),
                    type: "button",
                    oouiIcon: "listBullet",
                    action: {
                      type: "encapsulate",
                      options: {
                        pre: "* ",
                        peri: __wikieditor_i18n("wikieditor-toolbar-tool-ulist-example"),
                        post: "",
                        regex: /^([*#:;]*)\s*(.*)$/gm,
                        regexReplace: "$1* $2",
                        ownline: true,
                        splitlines: true
                      }
                    }
                  },
                  olist: {
                    label: __wikieditor_i18n("wikieditor-toolbar-tool-olist"),
                    type: "button",
                    oouiIcon: "listNumbered",
                    action: {
                      type: "encapsulate",
                      options: {
                        pre: "# ",
                        peri: __wikieditor_i18n("wikieditor-toolbar-tool-olist-example"),
                        post: "",
                        regex: /^([*#:;]*)\s*(.*)$/gm,
                        regexReplace: "$1# $2",
                        ownline: true,
                        splitlines: true
                      }
                    }
                  },
                  code: {
                    label: __wikieditor_i18n("wikieditor-toolbar-tool-code"),
                    type: "button",
                    oouiIcon: "code",
                    action: {
                      type: "encapsulate",
                      options: {
                        pre: "<code>",
                        peri: __wikieditor_i18n("wikieditor-toolbar-tool-code-example"),
                        post: "</code>"
                      }
                    }
                  },
                  nowiki: {
                    label: __wikieditor_i18n("wikieditor-toolbar-tool-nowiki"),
                    type: "button",
                    oouiIcon: "noWikiText",
                    action: {
                      type: "encapsulate",
                      options: {
                        pre: "<nowiki>",
                        peri: __wikieditor_i18n("wikieditor-toolbar-tool-nowiki-example"),
                        post: "</nowiki>"
                      }
                    },
                    hotkey: "\\"
                  },
                  newline: {
                    label: __wikieditor_i18n("wikieditor-toolbar-tool-newline"),
                    type: "button",
                    oouiIcon: "newline",
                    action: {
                      type: "encapsulate",
                      options: {
                        pre: "<br>\n"
                      }
                    }
                  }
                }
              },
              size: {
                tools: {
                  big: {
                    label: __wikieditor_i18n("wikieditor-toolbar-tool-big"),
                    type: "button",
                    oouiIcon: "bigger",
                    action: {
                      type: "encapsulate",
                      options: {
                        pre: "<big>",
                        peri: __wikieditor_i18n("wikieditor-toolbar-tool-big-example"),
                        post: "</big>"
                      }
                    }
                  },
                  small: {
                    label: __wikieditor_i18n("wikieditor-toolbar-tool-small"),
                    type: "button",
                    oouiIcon: "smaller",
                    action: {
                      type: "encapsulate",
                      options: {
                        pre: "<small>",
                        peri: __wikieditor_i18n("wikieditor-toolbar-tool-small-example"),
                        post: "</small>"
                      }
                    }
                  },
                  superscript: {
                    label: __wikieditor_i18n("wikieditor-toolbar-tool-superscript"),
                    type: "button",
                    oouiIcon: "superscript",
                    action: {
                      type: "encapsulate",
                      options: {
                        pre: "<sup>",
                        peri: __wikieditor_i18n("wikieditor-toolbar-tool-superscript-example"),
                        post: "</sup>"
                      }
                    },
                    hotkey: "."
                  },
                  subscript: {
                    label: __wikieditor_i18n("wikieditor-toolbar-tool-subscript"),
                    type: "button",
                    oouiIcon: "subscript",
                    action: {
                      type: "encapsulate",
                      options: {
                        pre: "<sub>",
                        peri: __wikieditor_i18n("wikieditor-toolbar-tool-subscript-example"),
                        post: "</sub>"
                      }
                    },
                    hotkey: ","
                  }
                }
              },
              insert: {
                label: __wikieditor_i18n("wikieditor-toolbar-group-insert"),
                tools: {
                  gallery: {
                    label: __wikieditor_i18n("wikieditor-toolbar-tool-gallery"),
                    type: "button",
                    oouiIcon: "imageGallery",
                    action: {
                      type: "encapsulate",
                      options: {
                        pre: "<gallery>\n",
                        peri: __wikieditor_i18n("wikieditor-toolbar-tool-gallery-example", fileNamespace),
                        post: "\n</gallery>",
                        ownline: true
                      }
                    }
                  },
                  redirect: {
                    label: __wikieditor_i18n("wikieditor-toolbar-tool-redirect"),
                    type: "button",
                    oouiIcon: "articleRedirect",
                    action: {
                      type: "encapsulate",
                      options: {
                        pre: configData.magicWords.redirect[0] + " [[",
                        peri: __wikieditor_i18n("wikieditor-toolbar-tool-redirect-example"),
                        post: "]]",
                        ownline: true
                      }
                    }
                  }
                }
              }
            }
          },
          characters: {
            label: __wikieditor_i18n("wikieditor-toolbar-section-characters"),
            type: "booklet",
            deferLoad: true,
            pages: {
              recent: {
                label: __wikieditor_i18n("special-characters-recently-used"),
                layout: "characters",
                characters: []
              },
              latin: {
                label: __wikieditor_i18n("special-characters-group-latin"),
                layout: "characters",
                characters: specialCharacterGroups.latin
              },
              latinextended: {
                label: __wikieditor_i18n("special-characters-group-latinextended"),
                layout: "characters",
                characters: specialCharacterGroups.latinextended
              },
              ipa: {
                label: __wikieditor_i18n("special-characters-group-ipa"),
                layout: "characters",
                characters: specialCharacterGroups.ipa
              },
              symbols: {
                label: __wikieditor_i18n("special-characters-group-symbols"),
                layout: "characters",
                characters: specialCharacterGroups.symbols
              },
              greek: {
                label: __wikieditor_i18n("special-characters-group-greek"),
                layout: "characters",
                language: "el",
                characters: specialCharacterGroups.greek
              },
              greekextended: {
                label: __wikieditor_i18n("special-characters-group-greekextended"),
                layout: "characters",
                characters: specialCharacterGroups.greekextended
              },
              cyrillic: {
                label: __wikieditor_i18n("special-characters-group-cyrillic"),
                layout: "characters",
                characters: specialCharacterGroups.cyrillic
              },
              // The core 28-letter alphabet, special letters for the Arabic language,
              // vowels, punctuation, digits.
              // Names of letters are written as in the Unicode charts.
              arabic: {
                label: __wikieditor_i18n("special-characters-group-arabic"),
                layout: "characters",
                language: "ar",
                direction: "rtl",
                characters: specialCharacterGroups.arabic
              },
              // Characters for languages other than Arabic.
              arabicextended: {
                label: __wikieditor_i18n("special-characters-group-arabicextended"),
                layout: "characters",
                language: "ar",
                direction: "rtl",
                characters: specialCharacterGroups.arabicextended
              },
              hebrew: {
                label: __wikieditor_i18n("special-characters-group-hebrew"),
                layout: "characters",
                direction: "rtl",
                characters: specialCharacterGroups.hebrew
              },
              bangla: {
                label: __wikieditor_i18n("special-characters-group-bangla"),
                language: "bn",
                layout: "characters",
                characters: specialCharacterGroups.bangla
              },
              tamil: {
                label: __wikieditor_i18n("special-characters-group-tamil"),
                language: "ta",
                layout: "characters",
                characters: specialCharacterGroups.tamil
              },
              telugu: {
                label: __wikieditor_i18n("special-characters-group-telugu"),
                language: "te",
                layout: "characters",
                characters: specialCharacterGroups.telugu
              },
              sinhala: {
                label: __wikieditor_i18n("special-characters-group-sinhala"),
                language: "si",
                layout: "characters",
                characters: specialCharacterGroups.sinhala
              },
              devanagari: {
                label: __wikieditor_i18n("special-characters-group-devanagari"),
                layout: "characters",
                characters: specialCharacterGroups.devanagari
              },
              gujarati: {
                label: __wikieditor_i18n("special-characters-group-gujarati"),
                language: "gu",
                layout: "characters",
                characters: specialCharacterGroups.gujarati
              },
              thai: {
                label: __wikieditor_i18n("special-characters-group-thai"),
                language: "th",
                layout: "characters",
                characters: specialCharacterGroups.thai
              },
              lao: {
                label: __wikieditor_i18n("special-characters-group-lao"),
                language: "lo",
                layout: "characters",
                characters: specialCharacterGroups.lao
              },
              khmer: {
                label: __wikieditor_i18n("special-characters-group-khmer"),
                language: "km",
                layout: "characters",
                characters: specialCharacterGroups.khmer
              },
              canadianaboriginal: {
                label: __wikieditor_i18n("special-characters-group-canadianaboriginal"),
                language: "cr",
                layout: "characters",
                characters: specialCharacterGroups.canadianaboriginal
              },
              runes: {
                label: __wikieditor_i18n("special-characters-group-runes"),
                layout: "characters",
                characters: specialCharacterGroups.runes
              }
            }
          },
          help: {
            label: __wikieditor_i18n("wikieditor-toolbar-section-help"),
            type: "booklet",
            deferLoad: true,
            pages: {
              format: {
                label: __wikieditor_i18n("wikieditor-toolbar-help-page-format"),
                layout: "table",
                headings: [
                  { msg: "wikieditor-toolbar-help-heading-description" },
                  { msg: "wikieditor-toolbar-help-heading-syntax" },
                  { msg: "wikieditor-toolbar-help-heading-result" }
                ],
                rows: [
                  {
                    description: {
                      html: __wikieditor_i18n("wikieditor-toolbar-help-content-italic-description").parse()
                    },
                    syntax: {
                      html: "''" + __wikieditor_i18n("wikieditor-toolbar-help-content-italic-example").escaped() + "''"
                    },
                    result: {
                      html: "<em>" + __wikieditor_i18n("wikieditor-toolbar-help-content-italic-example").parse() + "</em>"
                    }
                  },
                  {
                    description: {
                      html: __wikieditor_i18n("wikieditor-toolbar-help-content-bold-description").parse()
                    },
                    syntax: {
                      html: "'''" + __wikieditor_i18n("wikieditor-toolbar-help-content-bold-example").escaped() + "'''"
                    },
                    result: {
                      html: "<strong>" + __wikieditor_i18n("wikieditor-toolbar-help-content-bold-example").parse() + "</strong>"
                    }
                  },
                  {
                    description: {
                      html: __wikieditor_i18n("wikieditor-toolbar-help-content-bolditalic-description").parse()
                    },
                    syntax: {
                      html: "'''''" + __wikieditor_i18n("wikieditor-toolbar-help-content-bolditalic-example").escaped() + "'''''"
                    },
                    result: {
                      html: "<strong><em>" + __wikieditor_i18n("wikieditor-toolbar-help-content-bolditalic-example").parse() + "</em></strong>"
                    }
                  }
                ]
              },
              link: {
                label: __wikieditor_i18n("wikieditor-toolbar-help-page-link"),
                layout: "table",
                headings: [
                  { msg: "wikieditor-toolbar-help-heading-description" },
                  { msg: "wikieditor-toolbar-help-heading-syntax" },
                  { msg: "wikieditor-toolbar-help-heading-result" }
                ],
                rows: [
                  {
                    description: {
                      html: __wikieditor_i18n("wikieditor-toolbar-help-content-ilink-description").parse()
                    },
                    syntax: {
                      html: __wikieditor_i18n("wikieditor-toolbar-help-content-ilink-example").escaped()
                    },
                    result: {
                      html: '<span class="pre-wrap">' + delink(__wikieditor_i18n("wikieditor-toolbar-help-content-ilink-example").parseDom()) + "</span>"
                    }
                  },
                  {
                    description: {
                      html: __wikieditor_i18n("wikieditor-toolbar-help-content-xlink-description").parse()
                    },
                    syntax: {
                      html: __wikieditor_i18n(
                        "wikieditor-toolbar-help-content-xlink-example1",
                        __wikieditor_i18n("wikieditor-toolbar-help-content-xlink-example-url"),
                        __wikieditor_i18n("wikieditor-toolbar-help-content-xlink-example-label")
                      ).escaped()
                    },
                    result: {
                      html: '<span class="mw-parser-output pre-wrap">' + delink(__wikieditor_i18n(
                        "wikieditor-toolbar-help-content-xlink-example2",
                        __wikieditor_i18n("wikieditor-toolbar-help-content-xlink-example-url"),
                        __wikieditor_i18n("wikieditor-toolbar-help-content-xlink-example-label"),
                        1
                      ).parseDom()) + "</span>"
                    }
                  }
                ]
              },
              heading: {
                label: __wikieditor_i18n("wikieditor-toolbar-help-page-heading"),
                layout: "table",
                headings: [
                  { msg: "wikieditor-toolbar-help-heading-description" },
                  { msg: "wikieditor-toolbar-help-heading-syntax" },
                  { msg: "wikieditor-toolbar-help-heading-result" }
                ],
                rows: [
                  {
                    description: {
                      html: __wikieditor_i18n("wikieditor-toolbar-help-content-heading2-description").parse()
                    },
                    syntax: {
                      html: "== " + __wikieditor_i18n("wikieditor-toolbar-help-content-heading2-example").escaped() + " =="
                    },
                    result: {
                      html: "<h2>" + __wikieditor_i18n("wikieditor-toolbar-help-content-heading2-example").parse() + "</h2>"
                    }
                  },
                  {
                    description: {
                      html: __wikieditor_i18n("wikieditor-toolbar-help-content-heading3-description").parse()
                    },
                    syntax: {
                      html: "=== " + __wikieditor_i18n("wikieditor-toolbar-help-content-heading3-example").escaped() + " ==="
                    },
                    result: {
                      html: "<h3>" + __wikieditor_i18n("wikieditor-toolbar-help-content-heading3-example").parse() + "</h3>"
                    }
                  },
                  {
                    description: {
                      html: __wikieditor_i18n("wikieditor-toolbar-help-content-heading4-description").parse()
                    },
                    syntax: {
                      html: "==== " + __wikieditor_i18n("wikieditor-toolbar-help-content-heading4-example").escaped() + " ===="
                    },
                    result: {
                      html: "<h4>" + __wikieditor_i18n("wikieditor-toolbar-help-content-heading4-example").parse() + "</h4>"
                    }
                  },
                  {
                    description: {
                      html: __wikieditor_i18n("wikieditor-toolbar-help-content-heading5-description").parse()
                    },
                    syntax: {
                      html: "===== " + __wikieditor_i18n("wikieditor-toolbar-help-content-heading5-example").escaped() + " ====="
                    },
                    result: {
                      html: "<h5>" + __wikieditor_i18n("wikieditor-toolbar-help-content-heading5-example").parse() + "</h5>"
                    }
                  }
                ]
              },
              list: {
                label: __wikieditor_i18n("wikieditor-toolbar-help-page-list"),
                layout: "table",
                headings: [
                  { msg: "wikieditor-toolbar-help-heading-description" },
                  { msg: "wikieditor-toolbar-help-heading-syntax" },
                  { msg: "wikieditor-toolbar-help-heading-result" }
                ],
                rows: [
                  {
                    description: {
                      html: __wikieditor_i18n("wikieditor-toolbar-help-content-ulist-description").parse()
                    },
                    syntax: {
                      html: "* " + __wikieditor_i18n("wikieditor-toolbar-help-content-ulist-example").escaped() + "<br />* " + __wikieditor_i18n("wikieditor-toolbar-help-content-ulist-example").escaped()
                    },
                    result: {
                      html: "<ul><li>" + __wikieditor_i18n("wikieditor-toolbar-help-content-ulist-example").parse() + "</li><li>" + __wikieditor_i18n("wikieditor-toolbar-help-content-ulist-example").parse() + "</li></ul>"
                    }
                  },
                  {
                    description: {
                      html: __wikieditor_i18n("wikieditor-toolbar-help-content-olist-description").parse()
                    },
                    syntax: {
                      html: "# " + __wikieditor_i18n("wikieditor-toolbar-help-content-olist-example").escaped() + "<br /># " + __wikieditor_i18n("wikieditor-toolbar-help-content-olist-example").escaped()
                    },
                    result: {
                      html: "<ol><li>" + __wikieditor_i18n("wikieditor-toolbar-help-content-olist-example").parse() + "</li><li>" + __wikieditor_i18n("wikieditor-toolbar-help-content-olist-example").parse() + "</li></ol>"
                    }
                  }
                ]
              },
              file: {
                label: __wikieditor_i18n("wikieditor-toolbar-help-page-file"),
                layout: "table",
                headings: [
                  { msg: "wikieditor-toolbar-help-heading-description" },
                  { msg: "wikieditor-toolbar-help-heading-syntax" },
                  { msg: "wikieditor-toolbar-help-heading-result" }
                ],
                rows: [
                  {
                    description: {
                      html: __wikieditor_i18n("wikieditor-toolbar-help-content-file-description").parse()
                    },
                    syntax: {
                      html: __wikieditor_i18n(
                        "wikieditor-toolbar-help-content-file-syntax",
                        fileNamespace,
                        configData.magicWords.img_thumbnail[0],
                        __wikieditor_i18n("wikieditor-toolbar-help-content-file-caption")
                      ).escaped()
                    },
                    result: {
                      html: '<div class="thumbinner" style="width: 102px;"><a class="image"><img alt="" src="' + $.wikiEditor.imgPath + 'toolbar/example-image.png" width="100" height="50" class="thumbimage"/></a><div class="thumbcaption"><div class="magnify"><a title="' + __wikieditor_i18n("thumbnail-more").escaped() + '" class="internal"></a></div>' + __wikieditor_i18n("wikieditor-toolbar-help-content-file-caption").escaped() + "</div></div>"
                    }
                  }
                ]
              },
              discussion: {
                label: __wikieditor_i18n("wikieditor-toolbar-help-page-discussion"),
                layout: "table",
                headings: [
                  { msg: "wikieditor-toolbar-help-heading-description" },
                  { msg: "wikieditor-toolbar-help-heading-syntax" },
                  { msg: "wikieditor-toolbar-help-heading-result" }
                ],
                rows: [
                  {
                    description: {
                      html: __wikieditor_i18n("wikieditor-toolbar-help-content-signaturetimestamp-description").parse()
                    },
                    syntax: {
                      html: __wikieditor_i18n("wikieditor-toolbar-help-content-signaturetimestamp-syntax").escaped()
                    },
                    result: {
                      html: delink(__wikieditor_i18n(
                        "wikieditor-toolbar-help-content-signaturetimestamp-example",
                        "\u7528\u6237",
                        "\u7528\u6237\u8BA8\u8BBA",
                        "\u7528\u6237\u540D"
                      ).parseDom())
                    }
                  },
                  {
                    description: {
                      html: __wikieditor_i18n("wikieditor-toolbar-help-content-signature-description").parse()
                    },
                    syntax: {
                      html: __wikieditor_i18n("wikieditor-toolbar-help-content-signature-syntax").escaped()
                    },
                    result: {
                      html: delink(__wikieditor_i18n(
                        "wikieditor-toolbar-help-content-signature-example",
                        "\u7528\u6237",
                        "\u7528\u6237\u8BA8\u8BBA",
                        "\u7528\u6237\u540D"
                      ).parseDom())
                    }
                  },
                  {
                    description: {
                      html: __wikieditor_i18n("wikieditor-toolbar-help-content-indent-description").parse()
                    },
                    syntax: {
                      html: __wikieditor_i18n("wikieditor-toolbar-help-content-indent1").escaped() + "<br />:" + __wikieditor_i18n("wikieditor-toolbar-help-content-indent2").escaped() + "<br />::" + __wikieditor_i18n("wikieditor-toolbar-help-content-indent3").escaped()
                    },
                    result: {
                      html: __wikieditor_i18n("wikieditor-toolbar-help-content-indent1").parse() + "<dl><dd>" + __wikieditor_i18n("wikieditor-toolbar-help-content-indent2").parse() + "<dl><dd>" + __wikieditor_i18n("wikieditor-toolbar-help-content-indent3").parse() + "</dd></dl></dd></dl>"
                    }
                  }
                ]
              }
            }
          }
        }
      };
      module.exports = toolbarConfig;
    }
  });

  // insertlink/LinkTypeField.js
  var require_LinkTypeField = __commonJS({
    "insertlink/LinkTypeField.js"(exports, module) {
      var __wikieditor_i18n2 = require_ext_wikiEditor_i18n().i18n;
      function LinkTypeField() {
        OO.EventEmitter.call(this);
        this.radioInt = new OO.ui.RadioOptionWidget({
          label: __wikieditor_i18n2("wikieditor-toolbar-tool-link-int")
        });
        this.radioExt = new OO.ui.RadioOptionWidget({
          label: __wikieditor_i18n2("wikieditor-toolbar-tool-link-ext")
        });
        const radioSelect = new OO.ui.RadioSelectWidget({
          items: [
            this.radioInt,
            this.radioExt
          ]
        });
        radioSelect.connect(this, {
          choose: this.onRadioChoose
        });
        const config = {
          align: "top",
          classes: ["mw-wikiEditor-InsertLink-LinkTypeField"]
        };
        LinkTypeField.super.call(this, radioSelect, config);
      }
      __name(LinkTypeField, "LinkTypeField");
      OO.inheritClass(LinkTypeField, OO.ui.FieldLayout);
      OO.mixinClass(LinkTypeField, OO.EventEmitter);
      LinkTypeField.static.LINK_MODE_INTERNAL = "internal";
      LinkTypeField.static.LINK_MODE_EXTERNAL = "external";
      LinkTypeField.prototype.setIsExternal = function(isExternal) {
        this.getField().selectItem(isExternal ? this.radioExt : this.radioInt);
      };
      LinkTypeField.prototype.isInternal = function() {
        return this.radioInt.isSelected();
      };
      LinkTypeField.prototype.onRadioChoose = function() {
        this.emit("change", this.radioExt.isSelected());
      };
      module.exports = LinkTypeField;
    }
  });

  // insertlink/TitleOptionWidget.js
  var require_TitleOptionWidget = __commonJS({
    "insertlink/TitleOptionWidget.js"(exports, module) {
      var __wikieditor_i18n2 = require_ext_wikiEditor_i18n().i18n;
      function InsertLinkTitleOptionWidget(config) {
        this.external = config.external || false;
        if (this.external) {
          config.icon = "linkExternal";
          config.description = __wikieditor_i18n2("wikieditor-toolbar-tool-link-int-target-status-external");
          config.url = config.data.slice(0, 1).toLowerCase() + config.data.slice(1);
          config.data = config.url;
          if (!/^[a-z]+:\/\/./.test(config.url)) {
            config.url = "http://" + config.url;
          }
          config.missing = false;
        }
        this.disambiguation = config.disambiguation || false;
        this.missing = config.missing || false;
        InsertLinkTitleOptionWidget.super.call(this, config);
      }
      __name(InsertLinkTitleOptionWidget, "InsertLinkTitleOptionWidget");
      OO.inheritClass(InsertLinkTitleOptionWidget, OO.ui.Widget);
      InsertLinkTitleOptionWidget.prototype.isExternal = function() {
        return this.external;
      };
      InsertLinkTitleOptionWidget.prototype.isMissing = function() {
        return this.missing;
      };
      InsertLinkTitleOptionWidget.prototype.isDisambiguation = function() {
        return this.disambiguation;
      };
      module.exports = InsertLinkTitleOptionWidget;
    }
  });

  // insertlink/TitleInputWidget.js
  var require_TitleInputWidget = __commonJS({
    "insertlink/TitleInputWidget.js"(exports, module) {
      var InsertLinkTitleOptionWidget = require_TitleOptionWidget();
      var __wikieditor_i18n2 = require_ext_wikiEditor_i18n().i18n;
      function TitleInputWidget() {
        TitleInputWidget.super.call(this, {
          showImages: true,
          showDescriptions: true,
          showDisambigsLast: true,
          placeholder: __wikieditor_i18n2("wikieditor-toolbar-tool-link-int-target-tooltip"),
          $overlay: this.getOverlay(),
          validateTitle: false,
          showInterwikis: true,
          required: true,
          addQueryInput: true
        });
      }
      __name(TitleInputWidget, "TitleInputWidget");
      OO.inheritClass(TitleInputWidget, OO.ui.Widget);
      TitleInputWidget.static.urlRegex = new RegExp("^(http|https|ftp|sftp|www\\.)", "i");
      TitleInputWidget.prototype.onLookupInputBlur = function() {
        TitleInputWidget.super.prototype.onLookupInputBlur.apply(this);
        this.selectFirstMatch();
      };
      TitleInputWidget.prototype.selectFirstMatch = function() {
        this.getLookupMenuItems().then((items) => {
          for (let i = 0; i < items.length; i++) {
            const item = items[i];
            const queryVal = this.getQueryValue();
            if (item.getData() === queryVal || item.getData() === queryVal.charAt(0).toUpperCase() + queryVal.slice(1)) {
              this.emit("select", item);
              break;
            }
          }
        });
      };
      TitleInputWidget.prototype.getOptionWidgetData = function(title, data) {
        const widgetData = TitleInputWidget.super.prototype.getOptionWidgetData.call(this, title, data);
        widgetData.external = data.originalData.external;
        return widgetData;
      };
      TitleInputWidget.prototype.createOptionWidget = function(data) {
        return new InsertLinkTitleOptionWidget(data);
      };
      TitleInputWidget.prototype.getLookupCacheDataFromResponse = function(response) {
        const res = TitleInputWidget.super.prototype.getLookupCacheDataFromResponse(response);
        if (res.pages === void 0) {
          return res;
        }
        for (const pageId in res.pages) {
          if (Object.prototype.hasOwnProperty.call(res.pages, pageId)) {
            const page = res.pages[pageId];
            page.external = page.missing !== void 0 && this.looksLikeExternalLink(page.title);
          }
        }
        return res;
      };
      TitleInputWidget.prototype.onLookupMenuChoose = function(item) {
        TitleInputWidget.super.prototype.onLookupMenuChoose.call(this, item);
        this.emit("select", item);
      };
      TitleInputWidget.prototype.getOverlay = function() {
        return OO.ui.getDefaultOverlay().clone().css("z-index", "1010").appendTo(document.body);
      };
      TitleInputWidget.prototype.looksLikeExternalLink = function(urlString) {
        return this.constructor.static.urlRegex.test(urlString);
      };
      module.exports = TitleInputWidget;
    }
  });

  // insertlink/TitleInputField.js
  var require_TitleInputField = __commonJS({
    "insertlink/TitleInputField.js"(exports, module) {
      var LinkTypeField = require_LinkTypeField();
      var TitleInputWidget = require_TitleInputWidget();
      var __wikieditor_i18n2 = require_ext_wikiEditor_i18n().i18n;
      function TitleInputField() {
        OO.EventEmitter.call(this);
        const input = new TitleInputWidget();
        input.connect(this, {
          change: this.onChange,
          select: this.onSelect
        });
        this.urlMode = LinkTypeField.static.LINK_MODE_INTERNAL;
        this.urlModeManual = false;
        const config = {
          align: "top",
          label: __wikieditor_i18n2("wikieditor-toolbar-tool-link-int-target"),
          classes: ["mw-wikiEditor-InsertLink-TitleInputField"]
        };
        TitleInputField.super.call(this, input, config);
      }
      __name(TitleInputField, "TitleInputField");
      OO.inheritClass(TitleInputField, OO.ui.FieldLayout);
      OO.mixinClass(TitleInputField, OO.EventEmitter);
      TitleInputField.prototype.reset = function() {
        this.getField().setValue("");
        this.urlModeManual = false;
        this.urlMode = LinkTypeField.static.LINK_MODE_INTERNAL;
      };
      TitleInputField.prototype.setUrlMode = function(urlMode) {
        this.urlMode = urlMode === LinkTypeField.static.LINK_MODE_EXTERNAL ? LinkTypeField.static.LINK_MODE_EXTERNAL : LinkTypeField.static.LINK_MODE_INTERNAL;
        this.urlModeManual = true;
        this.getField().selectFirstMatch();
        this.validate(this.getField().getValue());
      };
      TitleInputField.prototype.isExternal = function() {
        return this.urlMode === LinkTypeField.static.LINK_MODE_EXTERNAL;
      };
      TitleInputField.prototype.makeMessage = function(kind, text) {
        this.message = new OO.ui.MessageWidget({
          type: kind,
          inline: true,
          label: text
        });
        return this.message.$element;
      };
      TitleInputField.prototype.setMessage = function(icon, message, type) {
        this.setNotices([message]);
        this.message.setIcon(icon).setType(type);
      };
      TitleInputField.prototype.onChange = function(value) {
        if (!this.urlModeManual && this.getField().looksLikeExternalLink(value)) {
          this.urlMode = LinkTypeField.static.LINK_MODE_EXTERNAL;
        }
        this.validate(value);
      };
      TitleInputField.prototype.validate = function(value) {
        if (this.urlMode === LinkTypeField.static.LINK_MODE_INTERNAL && value !== "" && true) {
          this.setMessage(
            "error",
            __wikieditor_i18n2("wikieditor-toolbar-tool-link-int-target-status-invalid").parse(),
            "error"
          );
          this.emit("invalid");
        } else {
          this.setNotices([]);
          this.emit("change", value);
        }
      };
      TitleInputField.prototype.onSelect = function(item) {
        let icon, msg;
        if (this.urlMode === LinkTypeField.static.LINK_MODE_EXTERNAL || !this.urlModeManual && this.urlMode === LinkTypeField.static.LINK_MODE_INTERNAL && item.isExternal()) {
          icon = "linkExternal";
          msg = "wikieditor-toolbar-tool-link-int-target-status-external";
        } else if (item.isDisambiguation()) {
          icon = "articleDisambiguation";
          msg = "wikieditor-toolbar-tool-link-int-target-status-disambig";
        } else if (!item.isMissing() && !item.isExternal()) {
          icon = "article";
          msg = "wikieditor-toolbar-tool-link-int-target-status-exists";
        } else {
          icon = "articleNotFound";
          msg = "wikieditor-toolbar-tool-link-int-target-status-notexists";
        }
        this.setMessage(icon, __wikieditor_i18n2(msg).parse());
      };
      module.exports = TitleInputField;
    }
  });

  // insertlink/LinkTextField.js
  var require_LinkTextField = __commonJS({
    "insertlink/LinkTextField.js"(exports, module) {
      var __wikieditor_i18n2 = require_ext_wikiEditor_i18n().i18n;
      function LinkTextField() {
        const input = new OO.ui.TextInputWidget({
          placeholder: __wikieditor_i18n2("wikieditor-toolbar-tool-link-int-text-tooltip")
        });
        input.connect(this, {
          change: "onInputChange"
        });
        const config = {
          align: "top",
          label: __wikieditor_i18n2("wikieditor-toolbar-tool-link-int-text"),
          classes: ["mw-wikiEditor-InsertLink-LinkTextField"]
        };
        LinkTextField.super.call(this, input, config);
        this.touched = false;
      }
      __name(LinkTextField, "LinkTextField");
      OO.inheritClass(LinkTextField, OO.ui.FieldLayout);
      LinkTextField.prototype.setValueIfUntouched = function(val) {
        if (!this.touched) {
          this.getField().setValue(val);
        }
      };
      LinkTextField.prototype.setTouched = function(touched) {
        this.touched = touched;
      };
      LinkTextField.prototype.onInputChange = function() {
        if ($.contains(this.$element[0], document.activeElement)) {
          this.touched = true;
        }
      };
      module.exports = LinkTextField;
    }
  });

  // jquery.wikiEditor.dialogs.config.js
  var require_jquery_wikiEditor_dialogs_config = __commonJS({
    "jquery.wikiEditor.dialogs.config.js"(exports, module) {
      var __wikieditor_i18n2 = require_ext_wikiEditor_i18n().i18n;
      var toolbarModule = require_jquery_wikiEditor_toolbar();
      var InsertLinkTitleInputField = require_TitleInputField();
      var LinkTextField = require_LinkTextField();
      var LinkTypeField = require_LinkTypeField();
      var insertLinkTitleInputField = new InsertLinkTitleInputField();
      var insertLinkLinkTextField = new LinkTextField();
      var insertLinkLinkTypeField = new LinkTypeField();
      var configData = require_data();
      function triggerButtonClick($element) {
        const dialogAction = $element.data("dialogaction");
        const $button = dialogAction ? $(dialogAction) : $element.find("button").first();
        if ($button) {
          $button.trigger("click");
        }
      }
      __name(triggerButtonClick, "triggerButtonClick");
      module.exports = {
        /**
         * @param {jQuery} $textarea
         * @memberof module:ext.wikiEditor
         */
        replaceIcons: /* @__PURE__ */ __name(function($textarea) {
          $textarea.wikiEditor("addToToolbar", {
            section: "main",
            group: "insert",
            tools: {
              link: {
                label: __wikieditor_i18n2("wikieditor-toolbar-tool-link"),
                type: "button",
                oouiIcon: "link",
                action: {
                  type: "dialog",
                  module: "insert-link"
                },
                hotkey: 75
                // K
              },
              file: {
                label: __wikieditor_i18n2("wikieditor-toolbar-tool-file"),
                type: "button",
                oouiIcon: "image",
                action: {
                  type: "dialog",
                  module: "insert-file"
                }
              }
            }
          }).wikiEditor("addToToolbar", {
            section: "advanced",
            group: "insert",
            tools: {
              table: {
                label: __wikieditor_i18n2("wikieditor-toolbar-tool-table"),
                type: "button",
                oouiIcon: "table",
                action: {
                  type: "dialog",
                  module: "insert-table"
                }
              }
            }
          }).wikiEditor("addToToolbar", {
            section: "secondary",
            group: "default",
            tools: {
              replace: {
                label: __wikieditor_i18n2("wikieditor-toolbar-tool-replace"),
                type: "button",
                oouiIcon: "articleSearch",
                action: {
                  type: "dialog",
                  module: "search-and-replace"
                }
              }
            }
          });
        }, "replaceIcons"),
        /**
         * @return {Object}
         * @memberof module:ext.wikiEditor
         */
        getDefaultConfig: /* @__PURE__ */ __name(function() {
          return { dialogs: {
            "insert-link": {
              title: __wikieditor_i18n2("wikieditor-toolbar-tool-link-title"),
              id: "wikieditor-toolbar-link-dialog",
              html: $("<fieldset>").append(
                insertLinkTitleInputField.$element,
                insertLinkLinkTextField.$element,
                insertLinkLinkTypeField.$element
              ),
              init: /* @__PURE__ */ __name(function() {
                const setButtonState = /* @__PURE__ */ __name(function(enable) {
                  $(".wikieditor-toolbar-tool-link-insert").button("option", "disabled", !enable);
                }, "setButtonState");
                insertLinkTitleInputField.connect(this, {
                  change: /* @__PURE__ */ __name(function(val) {
                    insertLinkLinkTypeField.setIsExternal(insertLinkTitleInputField.isExternal());
                    insertLinkLinkTextField.setValueIfUntouched(val);
                    setButtonState(val !== "");
                  }, "change"),
                  invalid: /* @__PURE__ */ __name(function() {
                    setButtonState(false);
                  }, "invalid")
                });
                insertLinkLinkTypeField.connect(this, {
                  change: /* @__PURE__ */ __name(function(isExternal) {
                    const urlMode = isExternal ? LinkTypeField.static.LINK_MODE_EXTERNAL : LinkTypeField.static.LINK_MODE_INTERNAL;
                    insertLinkTitleInputField.setUrlMode(urlMode);
                  }, "change")
                });
              }, "init"),
              dialog: {
                width: 500,
                dialogClass: "wikiEditor-toolbar-dialog",
                buttons: {
                  "wikieditor-toolbar-tool-link-insert": {
                    class: "wikieditor-toolbar-tool-link-insert",
                    text: __wikieditor_i18n2("wikieditor-toolbar-tool-link-insert"),
                    click: /* @__PURE__ */ __name(function() {
                      function escapeInternalText(s) {
                        return s.replace(/(\]{2,})/g, "<nowiki>$1</nowiki>");
                      }
                      __name(escapeInternalText, "escapeInternalText");
                      function escapeExternalTarget(s) {
                        return s.replace(/ /g, "%20").replace(/\[/g, "%5B").replace(/\]/g, "%5D");
                      }
                      __name(escapeExternalTarget, "escapeExternalTarget");
                      function escapeExternalText(s) {
                        return s.replace(/(\]+)/g, "<nowiki>$1</nowiki>");
                      }
                      __name(escapeExternalText, "escapeExternalText");
                      if ($(".wikieditor-toolbar-tool-link-insert").button("option", "disabled")) {
                        return;
                      }
                      let target = insertLinkTitleInputField.getField().getValue();
                      let text = insertLinkLinkTextField.getField().getValue();
                      if (text.trim() === "") {
                        text = "";
                      }
                      let insertText = "";
                      if (insertLinkLinkTypeField.isInternal()) {
                        if (target === text || !text.length) {
                          insertText = "[[" + target + "]]";
                        } else {
                          insertText = "[[" + target + "|" + escapeInternalText(text) + "]]";
                        }
                      } else {
                        target = target.trim();
                        if (!new RegExp(`^(?:http|https|ftp|sftp).`).test(target)) {
                          target = "http://" + target;
                        }
                        const match = target.match($(this).data("articlePathRegex"));
                        if (match && !$(this).data("ignoreLooksInternal")) {
                          const buttons = {};
                          const linkDialog = this;
                          buttons[__wikieditor_i18n2("wikieditor-toolbar-tool-link-lookslikeinternal-int")] = function() {
                            let titleValue = match[1];
                            try {
                              titleValue = decodeURI(titleValue);
                            } catch (ex) {
                            }
                            insertLinkTitleInputField.getField().setValue(titleValue);
                            insertLinkTitleInputField.setUrlMode(LinkTypeField.static.LINK_MODE_INTERNAL);
                            $(this).dialog("close");
                            insertLinkTitleInputField.getField().selectFirstMatch();
                          };
                          buttons[__wikieditor_i18n2("wikieditor-toolbar-tool-link-lookslikeinternal-ext")] = function() {
                            $(linkDialog).data("ignoreLooksInternal", true);
                            $(linkDialog).closest(".ui-dialog").find("button").first().trigger("click");
                            $(linkDialog).data("ignoreLooksInternal", false);
                            $(this).dialog("close");
                          };
                          $.wikiEditor.modules.dialogs.quickDialog(
                            __wikieditor_i18n2("wikieditor-toolbar-tool-link-lookslikeinternal", match[1]),
                            { buttons }
                          );
                          return;
                        }
                        const escTarget = escapeExternalTarget(target);
                        const escText = escapeExternalText(text);
                        if (escTarget === escText && !target.startsWith("//")) {
                          insertText = escTarget;
                        } else if (text === "") {
                          insertText = "[" + escTarget + "]";
                        } else {
                          insertText = "[" + escTarget + " " + escText + "]";
                        }
                      }
                      const whitespace = $("#wikieditor-toolbar-link-dialog").data("whitespace");
                      if (whitespace) {
                        insertText = whitespace[0] + insertText + whitespace[1];
                      }
                      $(this).dialog("close");
                      toolbarModule.fn.doAction($(this).data("context"), {
                        type: "replace",
                        options: {
                          pre: insertText
                        }
                      }, $(this));
                      insertLinkTitleInputField.reset();
                      insertLinkLinkTextField.getField().setValue("");
                      insertLinkLinkTypeField.getField().selectItem(null);
                    }, "click")
                  },
                  "wikieditor-toolbar-tool-link-cancel": /* @__PURE__ */ __name(function() {
                    $(this).dialog("close");
                  }, "wikieditor-toolbar-tool-link-cancel")
                },
                open: /* @__PURE__ */ __name(function() {
                  const serverName = "example";
                  $(this).data("articlePathRegex", new RegExp(
                    "^https?://" + escape(serverName + "").replace(/\\\$1/g, "(.*)") + "$"
                  ));
                  const context = $(this).data("context");
                  const selection = context.$textarea.textSelection("getSelection");
                  insertLinkTitleInputField.getField().focus();
                  insertLinkTitleInputField.getField().emit("change", insertLinkTitleInputField.getField().getValue());
                  $("#wikieditor-toolbar-link-dialog").data("whitespace", ["", ""]);
                  if (selection !== "") {
                    let matches, target, text, isExternal;
                    if (matches = selection.match(/^(\s*)\[\[([^\]|]+)(\|([^\]|]*))?\]\](\s*)$/)) {
                      target = matches[2];
                      text = matches[4] ? matches[4] : matches[2];
                      isExternal = false;
                      $("#wikieditor-toolbar-link-dialog").data("whitespace", [matches[1], matches[5]]);
                    } else if (matches = selection.match(/^(\s*)\[([^\] ]+)( ([^\]]+))?\](\s*)$/)) {
                      target = matches[2];
                      text = matches[4] || "";
                      isExternal = true;
                      $("#wikieditor-toolbar-link-dialog").data("whitespace", [matches[1], matches[5]]);
                    } else {
                      target = text = selection.trim();
                      if (target.length < selection.length) {
                        $("#wikieditor-toolbar-link-dialog").data(
                          "whitespace",
                          [
                            selection.slice(0, selection.indexOf(target.charAt(0))),
                            selection.slice(selection.lastIndexOf(target.charAt(target.length - 1)) + 1)
                          ]
                        );
                      }
                    }
                    if (typeof target !== "undefined") {
                      insertLinkTitleInputField.getField().setValue(target);
                    }
                    if (typeof text !== "undefined") {
                      insertLinkLinkTextField.getField().setValue(text);
                    }
                    insertLinkLinkTextField.setTouched(true);
                    if (typeof isExternal !== "undefined") {
                      const urlMode = isExternal ? LinkTypeField.static.LINK_MODE_EXTERNAL : LinkTypeField.static.LINK_MODE_INTERNAL;
                      insertLinkTitleInputField.setUrlMode(urlMode);
                    }
                  }
                  const $dialog = $(this).closest(".ui-dialog");
                  $dialog.removeData("dialogaction");
                  if (!$(this).data("dialogkeypressset")) {
                    $(this).data("dialogkeypressset", true);
                    $dialog.on("keypress", (e) => {
                      if ((e.keyCode || e.which) === 13) {
                        triggerButtonClick($dialog);
                        e.preventDefault();
                      }
                    });
                    $dialog.find("button").on("focus", (e) => {
                      $dialog.data("dialogaction", e.delegateTarget);
                    });
                  }
                }, "open")
              }
            },
            "insert-file": {
              title: __wikieditor_i18n2("wikieditor-toolbar-tool-file-title"),
              id: "wikieditor-toolbar-file-dialog",
              htmlTemplate: "dialogInsertFile.html",
              init: /* @__PURE__ */ __name(function() {
                const magicWordsI18N = configData.magicWords;
                $(this).find("[data-i18n-magic]").text(function() {
                  return magicWordsI18N[$(this).attr("data-i18n-magic")][0];
                }).removeAttr("data-i18n-magic");
                const defaultMsg = __wikieditor_i18n2("wikieditor-toolbar-file-default");
                $(this).find("#wikieditor-toolbar-file-size").attr("placeholder", defaultMsg).attr("size", defaultMsg.length);
                $(this).find("[rel]").text(function() {
                  return __wikieditor_i18n2($(this).attr("rel"));
                }).removeAttr("rel");
                const altHelpText = __wikieditor_i18n2("wikieditor-toolbar-file-alt-help");
                const altHelpLabel = __wikieditor_i18n2("wikieditor-toolbar-file-alt-help-label");
                const $altHelp = $(this).find(".wikieditor-toolbar-file-alt-help").text(altHelpLabel).on("click", () => {
                  $altHelp.text((i, text) => text === altHelpLabel ? altHelpText : altHelpLabel);
                });
              }, "init"),
              dialog: {
                resizable: false,
                dialogClass: "wikiEditor-toolbar-dialog",
                width: 590,
                buttons: {
                  "wikieditor-toolbar-tool-file-insert": /* @__PURE__ */ __name(function() {
                    const hasPxRgx = /.+px$/, magicWordsI18N = configData.magicWords;
                    let fileName = $("#wikieditor-toolbar-file-target").val();
                    const caption = $("#wikieditor-toolbar-file-caption").val();
                    const fileAlt = $("#wikieditor-toolbar-file-alt").val();
                    const fileFloat = $("#wikieditor-toolbar-file-float").val();
                    const fileFormat = $("#wikieditor-toolbar-file-format").val();
                    let fileSize = $("#wikieditor-toolbar-file-size").val();
                    const whitespace = $("#wikieditor-toolbar-file-dialog").data("whitespace");
                    if (fileSize !== "" && !hasPxRgx.test(fileSize)) {
                      fileSize += "px";
                    }
                    if (fileName !== "") {
                      let fileTitle = `File:${fileName}`;
                      if (fileTitle && fileTitle.getNamespaceId() !== 6) {
                        fileTitle = `File:${fileName}`;
                      }
                      if (fileTitle) {
                        fileName = fileTitle;
                      }
                    }
                    let options = [fileSize, fileFormat, fileFloat];
                    options = options.filter((val) => val.length && val !== "default");
                    if (fileAlt.length) {
                      options.push(magicWordsI18N.img_alt[0].replace("$1", fileAlt));
                    }
                    if (caption.length) {
                      options.push(caption);
                    }
                    const fileUse = options.length === 0 ? fileName : fileName + "|" + options.join("|");
                    $(this).dialog("close");
                    toolbarModule.fn.doAction(
                      $(this).data("context"),
                      {
                        type: "replace",
                        options: {
                          pre: whitespace[0] + "[[",
                          peri: fileUse,
                          post: "]]" + whitespace[1],
                          ownline: true
                        }
                      },
                      $(this)
                    );
                    $(
                      [
                        "#wikieditor-toolbar-file-target",
                        "#wikieditor-toolbar-file-caption",
                        "#wikieditor-toolbar-file-alt",
                        "#wikieditor-toolbar-file-size"
                      ].join(",")
                    ).val("");
                    $("#wikieditor-toolbar-file-float").val("default");
                    $("#wikieditor-toolbar-file-format").val(magicWordsI18N.img_thumbnail[0]);
                  }, "wikieditor-toolbar-tool-file-insert"),
                  "wikieditor-toolbar-tool-file-cancel": /* @__PURE__ */ __name(function() {
                    $(this).dialog("close");
                  }, "wikieditor-toolbar-tool-file-cancel"),
                  "wikieditor-toolbar-tool-file-upload": /* @__PURE__ */ __name(function() {
                    OO.ui.alert("Unsupported!");
                  }, "wikieditor-toolbar-tool-file-upload")
                },
                open: /* @__PURE__ */ __name(function() {
                  const magicWordsI18N = configData.magicWords, fileData = {
                    pre: "",
                    post: "",
                    fileName: "",
                    caption: "",
                    fileAlt: "",
                    fileSize: "",
                    fileFloat: "default",
                    fileFormat: magicWordsI18N.img_thumbnail[0]
                  };
                  const parseFileSyntax = /* @__PURE__ */ __name(function(wikitext) {
                    const escapedPipe = "";
                    if (wikitext.includes(escapedPipe)) {
                      return false;
                    }
                    const match = /^(\s*)\[\[(.*)\]\](\s*)$/.exec(wikitext);
                    if (!match) {
                      return false;
                    }
                    const params = match[2].replace(/\[\[[^[\]]*\]\]|\{\{[^{}]\}\}/g, (link) => link.replace(/\|/g, escapedPipe)).split("|");
                    const file = params[0];
                    if (!file || file.getNamespaceId() !== 6) {
                      return false;
                    }
                    const result = {
                      pre: match[1],
                      post: match[3],
                      fileName: file.getMainText()
                    };
                    for (let i = 1; i < params.length; i++) {
                      const paramOrig = params[i];
                      const param = paramOrig.toLowerCase();
                      if (magicWordsI18N.img_right.includes(param)) {
                        result.fileFloat = magicWordsI18N.img_right[0];
                      } else if (magicWordsI18N.img_left.includes(param)) {
                        result.fileFloat = magicWordsI18N.img_left[0];
                      } else if (magicWordsI18N.img_none.includes(param)) {
                        result.fileFloat = magicWordsI18N.img_none[0];
                      } else if (magicWordsI18N.img_center.includes(param)) {
                        result.fileFloat = magicWordsI18N.img_center[0];
                      } else if (magicWordsI18N.img_thumbnail.includes(param)) {
                        result.fileFormat = magicWordsI18N.img_thumbnail[0];
                      } else if (magicWordsI18N.img_framed.includes(param)) {
                        result.fileFormat = magicWordsI18N.img_framed[0];
                      } else if (magicWordsI18N.img_frameless.includes(param)) {
                        result.fileFormat = magicWordsI18N.img_frameless[0];
                      } else if (magicWordsI18N.img_alt.includes(param.split("=", 2)[0] + "=$1")) {
                        result.fileAlt = paramOrig.split("=", 2)[1];
                      } else if (/.+px$/.test(param)) {
                        result.fileSize = param.replace(/px$/, "");
                      } else if (param === "") {
                        continue;
                      } else if (i === params.length - 1) {
                        result.caption = paramOrig.replace(new RegExp(escape(escapedPipe), "g"), "|");
                      } else {
                        return false;
                      }
                    }
                    if (!result.fileFormat) {
                      result.fileFormat = "default";
                    }
                    return result;
                  }, "parseFileSyntax");
                  const context = $(this).data("context");
                  const selection = context.$textarea.textSelection("getSelection");
                  if (selection !== "") {
                    Object.assign(fileData, parseFileSyntax(selection));
                  }
                  $("#wikieditor-toolbar-file-dialog").data("whitespace", [fileData.pre, fileData.post]);
                  $("#wikieditor-toolbar-file-target").val(fileData.fileName);
                  $("#wikieditor-toolbar-file-caption").val(fileData.caption);
                  $("#wikieditor-toolbar-file-alt").val(fileData.fileAlt);
                  $("#wikieditor-toolbar-file-float").val(fileData.fileFloat);
                  $("#wikieditor-toolbar-file-format").val(fileData.fileFormat);
                  $("#wikieditor-toolbar-file-size").val(fileData.fileSize);
                  $("#wikieditor-toolbar-file-target").trigger("focus");
                  if (!$(this).data("dialogkeypressset")) {
                    $(this).data("dialogkeypressset", true);
                    const $dialog = $(this).closest(".ui-dialog");
                    $dialog.on("keypress", (e) => {
                      if (e.which === 13) {
                        triggerButtonClick($dialog);
                        e.preventDefault();
                      }
                    });
                    $dialog.find("button").on("focus", (e) => {
                      $dialog.data("dialogaction", e.delegateTarget);
                    });
                  }
                }, "open")
              }
            },
            "insert-table": {
              title: __wikieditor_i18n2("wikieditor-toolbar-tool-table-title"),
              id: "wikieditor-toolbar-table-dialog",
              htmlTemplate: "dialogInsertTable.html",
              init: /* @__PURE__ */ __name(function() {
                $(this).find("[rel]").each(function() {
                  $(this).text(__wikieditor_i18n2($(this).attr("rel")));
                });
                $("#wikieditor-toolbar-table-dimensions-rows").val(3);
                $("#wikieditor-toolbar-table-dimensions-columns").val(3);
                $("#wikieditor-toolbar-table-wikitable").on("click", () => {
                  $(".wikieditor-toolbar-table-preview").toggleClass("wikitable");
                });
                $("#wikieditor-toolbar-table-preview").clone().attr("id", "wikieditor-toolbar-table-preview2").addClass("sortable").insertAfter($("#wikieditor-toolbar-table-preview")).hide();
                ($("#wikieditor-toolbar-table-preview2").tablesorter ?? (() => {
                }))();
                $("#wikieditor-toolbar-table-sortable").on("click", () => {
                  $("#wikieditor-toolbar-table-preview").hide().attr("id", "wikieditor-toolbar-table-preview3");
                  $("#wikieditor-toolbar-table-preview2").attr("id", "wikieditor-toolbar-table-preview").show();
                  $("#wikieditor-toolbar-table-preview3").attr("id", "wikieditor-toolbar-table-preview2");
                });
                $("#wikieditor-toolbar-table-dimensions-header").on("click", () => {
                  const headerHTML = $(".wikieditor-toolbar-table-preview-header").html(), hiddenHTML = $(".wikieditor-toolbar-table-preview-hidden").html();
                  $(".wikieditor-toolbar-table-preview-header").html(hiddenHTML);
                  $(".wikieditor-toolbar-table-preview-hidden").html(headerHTML);
                  const $sortable = $("#wikieditor-toolbar-table-preview, #wikieditor-toolbar-table-preview2").filter(".sortable");
                  ($sortable.tablesorter ?? (() => {
                  }))();
                });
              }, "init"),
              dialog: {
                resizable: false,
                dialogClass: "wikiEditor-toolbar-dialog",
                width: 590,
                buttons: {
                  "wikieditor-toolbar-tool-table-insert": /* @__PURE__ */ __name(function() {
                    const rowsVal = $("#wikieditor-toolbar-table-dimensions-rows").val(), colsVal = $("#wikieditor-toolbar-table-dimensions-columns").val(), rows = parseInt(rowsVal, 10), cols = parseInt(colsVal, 10), header = $("#wikieditor-toolbar-table-dimensions-header").prop("checked") ? 1 : 0;
                    if (isNaN(rows) || isNaN(cols) || String(rows) !== rowsVal || String(cols) !== colsVal || rowsVal < 0 || colsVal < 0) {
                      alert(__wikieditor_i18n2("wikieditor-toolbar-tool-table-invalidnumber"));
                      return;
                    }
                    if (rows + header === 0 || cols === 0) {
                      alert(__wikieditor_i18n2("wikieditor-toolbar-tool-table-zero"));
                      return;
                    }
                    if (rows * cols > 1e3) {
                      alert(__wikieditor_i18n2("wikieditor-toolbar-tool-table-toomany", "1000"));
                      return;
                    }
                    const captionText = __wikieditor_i18n2("wikieditor-toolbar-tool-table-example-caption");
                    const headerText = __wikieditor_i18n2("wikieditor-toolbar-tool-table-example-header");
                    const normalText = __wikieditor_i18n2("wikieditor-toolbar-tool-table-example");
                    let table = "";
                    table += "|+ " + captionText + "\n";
                    for (let r = 0; r < rows + header; r++) {
                      table += "|-\n";
                      for (let c = 0; c < cols; c++) {
                        const isHeader = header && r === 0;
                        let delim = isHeader ? "!" : "|";
                        if (c > 0) {
                          delim += delim;
                        }
                        table += delim + " " + (isHeader ? headerText : normalText) + " ";
                      }
                      table = table.slice(0, table.length - 1) + "\n";
                    }
                    const classes = [];
                    if ($("#wikieditor-toolbar-table-wikitable").is(":checked")) {
                      classes.push("wikitable");
                    }
                    if ($("#wikieditor-toolbar-table-sortable").is(":checked")) {
                      classes.push("sortable");
                    }
                    const classStr = classes.length > 0 ? ' class="' + classes.join(" ") + '"' : "";
                    $(this).dialog("close");
                    toolbarModule.fn.doAction(
                      $(this).data("context"),
                      {
                        type: "replace",
                        options: {
                          pre: "{|" + classStr + "\n",
                          peri: table,
                          post: "|}",
                          ownline: true
                        }
                      },
                      $(this)
                    );
                    $("#wikieditor-toolbar-table-dimensions-rows").val(3);
                    $("#wikieditor-toolbar-table-dimensions-columns").val(3);
                    if (!$("#wikieditor-toolbar-table-dimensions-header").is(":checked")) {
                      $("#wikieditor-toolbar-table-dimensions-header").trigger("click");
                    }
                    if (!$("#wikieditor-toolbar-table-wikitable").is(":checked")) {
                      $("#wikieditor-toolbar-table-wikitable").trigger("click");
                    }
                    if ($("#wikieditor-toolbar-table-sortable").is(":checked")) {
                      $("#wikieditor-toolbar-table-sortable").trigger("click");
                    }
                  }, "wikieditor-toolbar-tool-table-insert"),
                  "wikieditor-toolbar-tool-table-cancel": /* @__PURE__ */ __name(function() {
                    $(this).dialog("close");
                  }, "wikieditor-toolbar-tool-table-cancel")
                },
                open: /* @__PURE__ */ __name(function() {
                  $("#wikieditor-toolbar-table-dimensions-rows").trigger("focus");
                  const $dialog = $(this).closest(".ui-dialog");
                  $dialog.removeData("dialogaction");
                  if (!$(this).data("dialogkeypressset")) {
                    $(this).data("dialogkeypressset", true);
                    $dialog.on("keypress", (e) => {
                      if ((e.keyCode || e.which) === 13) {
                        triggerButtonClick($dialog);
                        e.preventDefault();
                      }
                    });
                    $dialog.find("button").on("focus", (e) => {
                      $dialog.data("dialogaction", e.delegateTarget);
                    });
                  }
                }, "open")
              }
            },
            "search-and-replace": {
              title: __wikieditor_i18n2("wikieditor-toolbar-tool-replace-title"),
              id: "wikieditor-toolbar-replace-dialog",
              htmlTemplate: "dialogReplace.html",
              init: /* @__PURE__ */ __name(function() {
                $(this).find("[rel]").each(function() {
                  $(this).text(__wikieditor_i18n2($(this).attr("rel")));
                });
                $(this).data("replaceCallback", (mode) => {
                  $("#wikieditor-toolbar-replace-nomatch, #wikieditor-toolbar-replace-success, #wikieditor-toolbar-replace-emptysearch, #wikieditor-toolbar-replace-invalidregex").hide();
                  let searchStr = $("#wikieditor-toolbar-replace-search").val();
                  if (searchStr === "") {
                    $("#wikieditor-toolbar-replace-emptysearch").show();
                    return;
                  }
                  const replaceStr = $("#wikieditor-toolbar-replace-replace").val();
                  let flags = "m";
                  const matchCase = $("#wikieditor-toolbar-replace-case").is(":checked");
                  if (!matchCase) {
                    flags += "i";
                  }
                  const isRegex = $("#wikieditor-toolbar-replace-regex").is(":checked");
                  if (!isRegex) {
                    searchStr = escape(searchStr);
                  }
                  const matchWord = $("#wikieditor-toolbar-replace-word").is(":checked");
                  if (matchWord) {
                    searchStr = "\\b(?:" + searchStr + ")\\b";
                  }
                  if (mode === "replaceAll") {
                    flags += "g";
                  }
                  let regex;
                  try {
                    regex = new RegExp(searchStr, flags);
                  } catch (e) {
                    $("#wikieditor-toolbar-replace-invalidregex").text(__wikieditor_i18n2(
                      "wikieditor-toolbar-tool-replace-invalidregex",
                      e.message
                    )).show();
                    return;
                  }
                  const $textarea = $(this).data("context").$textarea;
                  let text = $textarea.textSelection("getContents");
                  let match = false;
                  let offset, textRemainder;
                  if (mode !== "replaceAll") {
                    offset = $(this).data(mode === "replace" ? "matchIndex" : "offset");
                    textRemainder = text.slice(offset);
                    match = textRemainder.match(regex);
                  }
                  if (!match) {
                    offset = 0;
                    textRemainder = text;
                    match = textRemainder.match(regex);
                  }
                  if (!match) {
                    $("#wikieditor-toolbar-replace-nomatch").show();
                  } else if (mode === "replaceAll") {
                    $textarea.textSelection("setContents", text.replace(regex, replaceStr));
                    $("#wikieditor-toolbar-replace-success").text(__wikieditor_i18n2("wikieditor-toolbar-tool-replace-success", match.length)).show();
                    $(this).data("offset", 0);
                  } else {
                    if (mode === "replace") {
                      let actualReplacement;
                      if (isRegex) {
                        actualReplacement = match[0].replace(regex, replaceStr);
                      } else {
                        actualReplacement = replaceStr;
                      }
                      if (match) {
                        $textarea.textSelection("encapsulateSelection", {
                          peri: actualReplacement,
                          replace: true,
                          selectionStart: offset + match.index,
                          selectionEnd: offset + match.index + match[0].length,
                          selectPeri: true
                        });
                        text = $textarea.textSelection("getContents");
                      }
                      offset = offset + match.index + actualReplacement.length;
                      textRemainder = text.slice(offset);
                      match = textRemainder.match(regex);
                      if (!match) {
                        offset = 0;
                        textRemainder = text;
                        match = textRemainder.match(regex);
                      }
                      if (!match) {
                        match = { index: 0, 0: { length: 0 } };
                      }
                    }
                    const start = offset + match.index;
                    const end = start + match[0].length;
                    $(this).data("matchIndex", start);
                    $textarea.textSelection("setSelection", {
                      start,
                      end
                    });
                    $textarea.textSelection("scrollToCaretPosition");
                    $(this).data("offset", end);
                    $textarea[0].focus();
                  }
                });
              }, "init"),
              dialog: {
                width: 500,
                dialogClass: "wikiEditor-toolbar-dialog",
                modal: false,
                buttons: {
                  "wikieditor-toolbar-tool-replace-button-findnext": /* @__PURE__ */ __name(function(e) {
                    $(this).closest(".ui-dialog").data("dialogaction", e.target);
                    $(this).data("replaceCallback").call(this, "find");
                  }, "wikieditor-toolbar-tool-replace-button-findnext"),
                  "wikieditor-toolbar-tool-replace-button-replace": /* @__PURE__ */ __name(function(e) {
                    $(this).closest(".ui-dialog").data("dialogaction", e.target);
                    $(this).data("replaceCallback").call(this, "replace");
                  }, "wikieditor-toolbar-tool-replace-button-replace"),
                  "wikieditor-toolbar-tool-replace-button-replaceall": /* @__PURE__ */ __name(function(e) {
                    $(this).closest(".ui-dialog").data("dialogaction", e.target);
                    $(this).data("replaceCallback").call(this, "replaceAll");
                  }, "wikieditor-toolbar-tool-replace-button-replaceall"),
                  "wikieditor-toolbar-tool-replace-close": /* @__PURE__ */ __name(function() {
                    $(this).dialog("close");
                  }, "wikieditor-toolbar-tool-replace-close")
                },
                open: /* @__PURE__ */ __name(function() {
                  $(this).data({ offset: 0, matchIndex: 0 });
                  const $dialog = $(this).closest(".ui-dialog");
                  $("#wikieditor-toolbar-replace-search").trigger("focus");
                  $("#wikieditor-toolbar-replace-nomatch, #wikieditor-toolbar-replace-success, #wikieditor-toolbar-replace-emptysearch, #wikieditor-toolbar-replace-invalidregex").hide();
                  if (!$(this).data("onetimeonlystuff")) {
                    $(this).data("onetimeonlystuff", true);
                    $dialog.on("keypress", (e) => {
                      if ((e.keyCode || e.which) === 13) {
                        triggerButtonClick($dialog);
                        e.preventDefault();
                      }
                    });
                    $dialog.find("button").on("focus", (e) => {
                      $dialog.data("dialogaction", e.delegateTarget);
                    });
                  }
                  const $textarea = $(this).data("context").$textarea;
                  $textarea.on("keypress.srdialog", (e) => {
                    if (e.which === 13) {
                      triggerButtonClick($textarea);
                      e.preventDefault();
                    } else if (e.which === 27) {
                      $(this).dialog("close");
                    }
                  });
                }, "open"),
                close: /* @__PURE__ */ __name(function() {
                  $(this).data("context").$textarea.off("keypress.srdialog");
                  $(this).closest(".ui-dialog").data("dialogaction", false);
                }, "close")
              }
            }
          } };
        }, "getDefaultConfig")
      };
    }
  });

  // ext.wikiEditor.js
  var editingSessionId;
  require_jquery_wikiEditor();
  function logEditEvent(data) {
    return;
  }
  __name(logEditEvent, "logEditEvent");
  function logEditFeature(feature, action) {
    return;
  }
  __name(logEditFeature, "logEditFeature");
  function logAbort(switchingToVE, unmodified) {
    if (switchingToVE) {
      logEditFeature("editor-switch", "visual-desktop");
    }
    let abortType;
    if (switchingToVE && unmodified) {
      abortType = "switchnochange";
    } else if (switchingToVE) {
      abortType = "switchwithout";
    } else if (unmodified) {
      abortType = "nochange";
    } else {
      abortType = "abandon";
    }
    logEditEvent({
      action: "abort",
      type: abortType
    });
  }
  __name(logAbort, "logAbort");
  $(() => {
    const $textarea = $("#wpTextbox1"), $editingSessionIdInput = $("#editingStatsId"), origText = $textarea.val();
    $("#wikieditorUsed").val("yes");
    if ($editingSessionIdInput.length) {
      editingSessionId = $editingSessionIdInput.val();
      if (window.performance && window.performance.timing) {
        const readyTime = Date.now();
        logEditEvent({
          action: "ready",
          timing: readyTime - window.performance.timing.navigationStart
        });
        $textarea.on("wikiEditor-toolbar-doneInitialSections", () => {
          logEditEvent({
            action: "loaded",
            timing: Date.now() - window.performance.timing.navigationStart
          });
        }).one("input", () => {
          logEditEvent({
            action: "firstChange",
            timing: Date.now() - readyTime
          });
        });
      }
      const $form = $textarea.closest("form");
      if (localStorage.get("wikieditor-uselivepreview")) {
        $form.find("#wpPreview").on("click", () => {
          logEditFeature("preview", "preview-live");
        });
      }
      let submitting;
      $form.on("submit", () => {
        submitting = true;
      });
      const onUnloadFallback = window.onunload;
      window.onunload = function() {
        const unmodified = false, caVeEdit = $("#ca-ve-edit")[0], switchingToVE = caVeEdit && (document.activeElement === caVeEdit || $.contains(caVeEdit, document.activeElement));
        let fallbackResult;
        if (onUnloadFallback) {
          fallbackResult = onUnloadFallback();
        }
        if (!submitting) {
          logAbort(switchingToVE, unmodified);
        }
        editingSessionId = Math.floor(Math.random() << 32).toString(16);
        $editingSessionIdInput.val(editingSessionId);
        return fallbackResult;
      };
      $textarea.on("wikiEditor-switching-visualeditor", () => {
        const unmodified = false;
        window.onunload = onUnloadFallback;
        logAbort(true, unmodified);
      });
    }
    $("#toolbar").remove();
  });
  window.addWikiEditor = function($textarea) {
    if ($textarea.css("display") === "none") {
      return;
    }
    $textarea.wikiEditor(
      "addModule",
      require_jquery_wikiEditor_toolbar_config()
    );
    const dialogsConfig = require_jquery_wikiEditor_dialogs_config();
    dialogsConfig.replaceIcons($textarea);
    $textarea.wikiEditor("addModule", dialogsConfig.getDefaultConfig());
  };
})();
